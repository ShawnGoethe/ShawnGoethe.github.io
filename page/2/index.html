<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.1.1">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha256-wiz7ZSCn/btzhjKDQBms9Hx4sSeUYsDrTLg7roPstac=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.19.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script>

    <meta property="og:type" content="website">
<meta property="og:title" content="Zehai&#39;s Blog">
<meta property="og:url" content="http://example.com/page/2/index.html">
<meta property="og:site_name" content="Zehai&#39;s Blog">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://example.com/page/2/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"en","comments":"","permalink":"","path":"page/2/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Zehai's Blog</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Zehai's Blog</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
    </div>
  </div>
</div>







</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">John Doe</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">106</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">29</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">34</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/10/16/2020-10-16-promise%E7%94%A8%E6%B3%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zehai's Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Zehai's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/10/16/2020-10-16-promise%E7%94%A8%E6%B3%95/" class="post-title-link" itemprop="url">2020-10-16-promiseç”¨æ³•</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2020-10-16 18:42:09" itemprop="dateCreated datePublished" datetime="2020-10-16T18:42:09+08:00">2020-10-16</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-04-07 22:34:12" itemprop="dateModified" datetime="2024-04-07T22:34:12+08:00">2024-04-07</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="What"><a href="#What" class="headerlink" title="What"></a>What</h1><p>ECMAscript 6 åŸç”Ÿæä¾›äº† Promise å¯¹è±¡ã€‚</p>
<p>Promise å¯¹è±¡ä»£è¡¨äº†æœªæ¥å°†è¦å‘ç”Ÿçš„äº‹ä»¶ï¼Œç”¨æ¥ä¼ é€’å¼‚æ­¥æ“ä½œçš„æ¶ˆæ¯ã€‚</p>
<h3 id="Promise-å¯¹è±¡æœ‰ä»¥ä¸‹ä¸¤ä¸ªç‰¹ç‚¹"><a href="#Promise-å¯¹è±¡æœ‰ä»¥ä¸‹ä¸¤ä¸ªç‰¹ç‚¹" class="headerlink" title="Promise å¯¹è±¡æœ‰ä»¥ä¸‹ä¸¤ä¸ªç‰¹ç‚¹:"></a>Promise å¯¹è±¡æœ‰ä»¥ä¸‹ä¸¤ä¸ªç‰¹ç‚¹:</h3><p>1ã€å¯¹è±¡çš„çŠ¶æ€ä¸å—å¤–ç•Œå½±å“ã€‚Promise å¯¹è±¡ä»£è¡¨ä¸€ä¸ªå¼‚æ­¥æ“ä½œï¼Œæœ‰ä¸‰ç§çŠ¶æ€ï¼š</p>
<ul>
<li>pending: åˆå§‹çŠ¶æ€ï¼Œä¸æ˜¯æˆåŠŸæˆ–å¤±è´¥çŠ¶æ€ã€‚</li>
<li>fulfilled: æ„å‘³ç€æ“ä½œæˆåŠŸå®Œæˆã€‚</li>
<li>rejected: æ„å‘³ç€æ“ä½œå¤±è´¥ã€‚</li>
</ul>
<p>åªæœ‰å¼‚æ­¥æ“ä½œçš„ç»“æœï¼Œå¯ä»¥å†³å®šå½“å‰æ˜¯å“ªä¸€ç§çŠ¶æ€ï¼Œä»»ä½•å…¶ä»–æ“ä½œéƒ½æ— æ³•æ”¹å˜è¿™ä¸ªçŠ¶æ€ã€‚è¿™ä¹Ÿæ˜¯ Promise è¿™ä¸ªåå­—çš„ç”±æ¥ï¼Œå®ƒçš„è‹±è¯­æ„æ€å°±æ˜¯ã€Œæ‰¿è¯ºã€ï¼Œè¡¨ç¤ºå…¶ä»–æ‰‹æ®µæ— æ³•æ”¹å˜ã€‚</p>
<p>2ã€ä¸€æ—¦çŠ¶æ€æ”¹å˜ï¼Œå°±ä¸ä¼šå†å˜ï¼Œä»»ä½•æ—¶å€™éƒ½å¯ä»¥å¾—åˆ°è¿™ä¸ªç»“æœã€‚Promise å¯¹è±¡çš„çŠ¶æ€æ”¹å˜ï¼Œåªæœ‰ä¸¤ç§å¯èƒ½ï¼šä» Pending å˜ä¸º Resolved å’Œä» Pending å˜ä¸º Rejectedã€‚åªè¦è¿™ä¸¤ç§æƒ…å†µå‘ç”Ÿï¼ŒçŠ¶æ€å°±å‡å›ºäº†ï¼Œä¸ä¼šå†å˜äº†ï¼Œä¼šä¸€ç›´ä¿æŒè¿™ä¸ªç»“æœã€‚å°±ç®—æ”¹å˜å·²ç»å‘ç”Ÿäº†ï¼Œä½ å†å¯¹ Promise å¯¹è±¡æ·»åŠ å›è°ƒå‡½æ•°ï¼Œä¹Ÿä¼šç«‹å³å¾—åˆ°è¿™ä¸ªç»“æœã€‚è¿™ä¸äº‹ä»¶ï¼ˆEventï¼‰å®Œå…¨ä¸åŒï¼Œäº‹ä»¶çš„ç‰¹ç‚¹æ˜¯ï¼Œå¦‚æœä½ é”™è¿‡äº†å®ƒï¼Œå†å»ç›‘å¬ï¼Œæ˜¯å¾—ä¸åˆ°ç»“æœçš„ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">var promise = new Promise(function(resolve, reject) &#123;</span><br><span class="line">    // å¼‚æ­¥å¤„ç†</span><br><span class="line">    // å¤„ç†ç»“æŸåã€è°ƒç”¨resolve æˆ– reject</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>ä»¥ä¸Šæ¥è‡ª:<a target="_blank" rel="noopener" href="https://www.runoob.com/w3cnote/javascript-promise-object.html">èœé¸Ÿhttps://www.runoob.com/w3cnote/javascript-promise-object.html</a></p>
<h1 id="Why"><a href="#Why" class="headerlink" title="Why"></a>Why</h1><p>å› ä¸ºåœ¨<a href="/2020/01/07/2020-01-07-%E5%85%B3%E4%BA%8EPromise%E7%9A%84%E6%80%9D%E8%80%83/">2020å¹´01æœˆ07æ—¥æœ‰ä¸€ç¯‡æ–‡ç« </a>è®²äº†ä½¿ç”¨promiseå®ç°å»¶æ—¶é˜Ÿåˆ—çš„ä¸€é“é¢è¯•é¢˜ï¼Œå› ä¸ºä¹‹å‰å†™ä¸šåŠ¡æ²¡æœ‰ç”¨åˆ°è¿‡æ‰€ä»¥ä¸€ç›´ä»¥ä¸ºç”¨å¤„ä¸å¤§ï¼Œä½†ä»Šå¤©å¯¹æ¥é˜¿é‡Œçš„<code>å½•éŸ³æ–‡ä»¶è¯†åˆ«</code>è½¬æ–‡å­—çš„æ¥å£ä¸­ï¼Œç¤ºä¾‹ä»£ç æ˜¯ä¸€ä¸ªsetIntervalè½®è¯¢å¾—åˆ°ç»“æœçš„ä¸€ç§æ–¹å¼ï¼Œä½†æ˜¯ä»–å¸¦æ¥äº†ä¸€ä¸ªå¾ˆä¸¥é‡çš„é—®é¢˜</p>
<blockquote>
<p>ï¼ï¼æ²¡æœ‰åŠæ³•è¿”å›å‰ç«¯è½¬æ–‡å­—çš„ç»“æœï¼ï¼</p>
</blockquote>
<p>å¤§æ¦‚ä»£ç å¦‚ä¸‹</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//url:https://help.aliyun.com/document_detail/94242.html?spm=a2c4g.11174283.6.601.15eb7275a8rq00</span></span><br><span class="line"><span class="comment">// è¿™æ®µä»£ç ä¼šå¼‚æ­¥æ‰§è¡Œï¼Œå¯ä»¥å¾—åˆ°ç»“æœï¼Œä½†æ˜¯ç›´æ¥ç”¨è¿™ä¸ªä»£ç è¿”å›ç»™å‰ç«¯</span></span><br><span class="line">client.<span class="title function_">submitTask</span>(taskParams, options).<span class="title function_">then</span>(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(response);</span><br><span class="line">        <span class="comment">// æœåŠ¡ç«¯å“åº”ä¿¡æ¯çš„çŠ¶æ€æè¿°StatusTextã€‚</span></span><br><span class="line">        <span class="keyword">var</span> statusText = response.<span class="property">StatusText</span>;</span><br><span class="line">        <span class="keyword">if</span> (statusText != <span class="string">&#x27;SUCCESS&#x27;</span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;å½•éŸ³æ–‡ä»¶è¯†åˆ«è¯·æ±‚å“åº”å¤±è´¥!&#x27;</span>)</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;å½•éŸ³æ–‡ä»¶è¯†åˆ«è¯·æ±‚å“åº”æˆåŠŸ!&#x27;</span>);</span><br><span class="line">        <span class="comment">// è·å–å½•éŸ³æ–‡ä»¶è¯†åˆ«è¯·æ±‚ä»»åŠ¡çš„TaskIdï¼Œä»¥ä¾›è¯†åˆ«ç»“æœæŸ¥è¯¢ä½¿ç”¨ã€‚</span></span><br><span class="line">        <span class="keyword">var</span> taskId = response.<span class="property">TaskId</span>;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * ä»¥TaskIdä¸ºæŸ¥è¯¢å‚æ•°ï¼Œæäº¤è¯†åˆ«ç»“æœæŸ¥è¯¢è¯·æ±‚ã€‚</span></span><br><span class="line"><span class="comment">         * ä»¥è½®è¯¢çš„æ–¹å¼è¿›è¡Œè¯†åˆ«ç»“æœçš„æŸ¥è¯¢ï¼Œç›´åˆ°æœåŠ¡ç«¯è¿”å›çš„çŠ¶æ€æè¿°ä¸º&quot;SUCCESS&quot;ã€SUCCESS_WITH_NO_VALID_FRAGMENTï¼Œ</span></span><br><span class="line"><span class="comment">         * æˆ–è€…ä¸ºé”™è¯¯æè¿°ï¼Œåˆ™ç»“æŸè½®è¯¢ã€‚</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        <span class="keyword">var</span> taskIdParams = &#123;</span><br><span class="line">            <span class="title class_">TaskId</span> : taskId</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">var</span> timer = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            client.<span class="title function_">getTaskResult</span>(taskIdParams).<span class="title function_">then</span>(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;è¯†åˆ«ç»“æœæŸ¥è¯¢å“åº”ï¼š&#x27;</span>);</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(response);</span><br><span class="line">                <span class="keyword">var</span> statusText = response.<span class="property">StatusText</span>;</span><br><span class="line">                <span class="keyword">if</span> (statusText == <span class="string">&#x27;RUNNING&#x27;</span> || statusText == <span class="string">&#x27;QUEUEING&#x27;</span>) &#123;</span><br><span class="line">                    <span class="comment">// ç»§ç»­è½®è¯¢ï¼Œæ³¨æ„é—´éš”å‘¨æœŸã€‚</span></span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (statusText == <span class="string">&#x27;SUCCESS&#x27;</span> || statusText == <span class="string">&#x27;SUCCESS_WITH_NO_VALID_FRAGMENT&#x27;</span>) &#123;</span><br><span class="line">                        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;å½•éŸ³æ–‡ä»¶è¯†åˆ«æˆåŠŸï¼š&#x27;</span>);</span><br><span class="line">                        <span class="keyword">var</span> sentences = response.<span class="property">Result</span>;</span><br><span class="line">                        <span class="variable language_">console</span>.<span class="title function_">log</span>(sentences);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;å½•éŸ³æ–‡ä»¶è¯†åˆ«å¤±è´¥!&#x27;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">// é€€å‡ºè½®è¯¢</span></span><br><span class="line">                    <span class="built_in">clearInterval</span>(timer);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;).<span class="title function_">catch</span>(<span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">error</span>(error);</span><br><span class="line">                <span class="comment">// å¼‚å¸¸æƒ…å†µï¼Œé€€å‡ºè½®è¯¢ã€‚</span></span><br><span class="line">                <span class="built_in">clearInterval</span>(timer);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;, <span class="number">10000</span>);</span><br><span class="line">    &#125;).<span class="title function_">catch</span>(<span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(error);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="How"><a href="#How" class="headerlink" title="How"></a>How</h1><p>ä½¿ç”¨promiseè¿›è¡ŒåŒ…è£¹ï¼Œç­‰åˆ°promiseå†…éƒ¨çš„å‡½æ•°å–åˆ°äº†ç»“æœåœ¨è¿”å›</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (statusText == <span class="string">&#x27;SUCCESS&#x27;</span> || statusText == <span class="string">&#x27;SUCCESS_WITH_NO_VALID_FRAGMENT&#x27;</span>) &#123;</span><br><span class="line">                        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;å½•éŸ³æ–‡ä»¶è¯†åˆ«æˆåŠŸï¼š&#x27;</span>);</span><br><span class="line">                        <span class="keyword">var</span> sentences = response.<span class="property">Result</span>;</span><br><span class="line">                        <span class="variable language_">console</span>.<span class="title function_">log</span>(sentences);</span><br><span class="line">  											<span class="comment">//è¿™é‡Œæ–°å¢resolve</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;å½•éŸ³æ–‡ä»¶è¯†åˆ«å¤±è´¥!&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¤–å±‚é€šè¿‡å¦‚ä¸‹ä»£ç å®ç°</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">var promise = new Promise(function(resolve, reject) &#123;</span><br><span class="line">    // å¼‚æ­¥å¤„ç†</span><br><span class="line">    // å¤„ç†ç»“æŸåã€è°ƒç”¨resolve æˆ– reject</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">getWords</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">        client</span><br><span class="line">          .<span class="title function_">submitTask</span>(taskParams, options)</span><br><span class="line">          .<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(response);</span><br><span class="line">            <span class="comment">// æœåŠ¡ç«¯å“åº”ä¿¡æ¯çš„çŠ¶æ€æè¿°StatusTextã€‚</span></span><br><span class="line">            <span class="keyword">const</span> statusText = response.<span class="property">StatusText</span>;</span><br><span class="line">            <span class="keyword">if</span> (statusText != <span class="string">&#x27;SUCCESS&#x27;</span>) &#123;</span><br><span class="line">              <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;å½•éŸ³æ–‡ä»¶è¯†åˆ«è¯·æ±‚å“åº”å¤±è´¥!&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;å½•éŸ³æ–‡ä»¶è¯†åˆ«è¯·æ±‚å“åº”æˆåŠŸ!&#x27;</span>);</span><br><span class="line">            <span class="comment">// è·å–å½•éŸ³æ–‡ä»¶è¯†åˆ«è¯·æ±‚ä»»åŠ¡çš„TaskIdï¼Œä»¥ä¾›è¯†åˆ«ç»“æœæŸ¥è¯¢ä½¿ç”¨ã€‚</span></span><br><span class="line">            <span class="keyword">const</span> taskId = response.<span class="property">TaskId</span>;</span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * ä»¥TaskIdä¸ºæŸ¥è¯¢å‚æ•°ï¼Œæäº¤è¯†åˆ«ç»“æœæŸ¥è¯¢è¯·æ±‚ã€‚</span></span><br><span class="line"><span class="comment">             * ä»¥è½®è¯¢çš„æ–¹å¼è¿›è¡Œè¯†åˆ«ç»“æœçš„æŸ¥è¯¢ï¼Œç›´åˆ°æœåŠ¡ç«¯è¿”å›çš„çŠ¶æ€æè¿°ä¸º&quot;SUCCESS&quot;ã€SUCCESS_WITH_NO_VALID_FRAGMENTï¼Œ</span></span><br><span class="line"><span class="comment">             * æˆ–è€…ä¸ºé”™è¯¯æè¿°ï¼Œåˆ™ç»“æŸè½®è¯¢ã€‚</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            <span class="keyword">const</span> taskIdParams = &#123;</span><br><span class="line">              <span class="title class_">TaskId</span>: taskId,</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">const</span> timer = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">              client</span><br><span class="line">                .<span class="title function_">getTaskResult</span>(taskIdParams)</span><br><span class="line">                .<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">                  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;è¯†åˆ«ç»“æœæŸ¥è¯¢å“åº”ï¼š&#x27;</span>);</span><br><span class="line">                  <span class="variable language_">console</span>.<span class="title function_">log</span>(response);</span><br><span class="line">                  <span class="keyword">const</span> statusText = response.<span class="property">StatusText</span>;</span><br><span class="line">                  <span class="keyword">if</span> (statusText == <span class="string">&#x27;RUNNING&#x27;</span> || statusText == <span class="string">&#x27;QUEUEING&#x27;</span>) &#123;</span><br><span class="line">                    <span class="comment">// ç»§ç»­è½®è¯¢ï¼Œæ³¨æ„é—´éš”å‘¨æœŸã€‚</span></span><br><span class="line">                  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (</span><br><span class="line">                      statusText == <span class="string">&#x27;SUCCESS&#x27;</span> ||</span><br><span class="line">                      statusText == <span class="string">&#x27;SUCCESS_WITH_NO_VALID_FRAGMENT&#x27;</span></span><br><span class="line">                    ) &#123;</span><br><span class="line">                      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;å½•éŸ³æ–‡ä»¶è¯†åˆ«æˆåŠŸï¼š&#x27;</span>);</span><br><span class="line">                      <span class="keyword">let</span> sentences = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">                      <span class="keyword">for</span> (<span class="keyword">const</span> s <span class="keyword">of</span> response.<span class="property">Result</span>.<span class="property">Sentences</span>) &#123;</span><br><span class="line">                        sentences += s.<span class="property">Text</span>;</span><br><span class="line">                      &#125;</span><br><span class="line">                      <span class="variable language_">console</span>.<span class="title function_">log</span>(response.<span class="property">Result</span>);</span><br><span class="line">                      <span class="title function_">resolve</span>(sentences);<span class="comment">//**é‡ç‚¹**//</span></span><br><span class="line">                      <span class="comment">// return sentences;</span></span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;å½•éŸ³æ–‡ä»¶è¯†åˆ«å¤±è´¥!&#x27;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">// é€€å‡ºè½®è¯¢</span></span><br><span class="line">                    <span class="built_in">clearInterval</span>(timer);</span><br><span class="line">                  &#125;</span><br><span class="line">                &#125;)</span><br><span class="line">                .<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">                  <span class="variable language_">console</span>.<span class="title function_">error</span>(error);</span><br><span class="line">                  <span class="comment">// å¼‚å¸¸æƒ…å†µï¼Œé€€å‡ºè½®è¯¢ã€‚</span></span><br><span class="line">                  <span class="built_in">clearInterval</span>(timer);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;, <span class="number">10000</span>);</span><br><span class="line">          &#125;)</span><br><span class="line">          .<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">error</span>(error);</span><br><span class="line">          &#125;);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">await</span> <span class="title function_">getWords</span>();<span class="comment">//è¿”å›å‰ç«¯ï¼Œç¿»è¯‘ç»“æœ</span></span><br></pre></td></tr></table></figure>



<blockquote>
<p>å¦å¤–è®°å½•ä¸€ä»¶äº‹æƒ…ï¼Œå·¦ä¾§å•å…ƒå›¾æ ‡åœ°å€ï¼š<a target="_blank" rel="noopener" href="https://fontawesome.com/v4.7.0/icons/">https://fontawesome.com/v4.7.0/icons/</a></p>
</blockquote>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/09/27/2020-09-27-NodeJS/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zehai's Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Zehai's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/09/27/2020-09-27-NodeJS/" class="post-title-link" itemprop="url">NodeJS</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2020-09-27 18:42:36" itemprop="dateCreated datePublished" datetime="2020-09-27T18:42:36+08:00">2020-09-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-04-07 22:34:12" itemprop="dateModified" datetime="2024-04-07T22:34:12+08:00">2024-04-07</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/theanarkh/understand-nodejs">https://github.com/theanarkh/understand-nodejs</a></p>
</blockquote>
<p>æ–‡æ¡£è¿˜æ˜¯ä¸é”™çš„</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/09/25/2020-09-25-Jupyter/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zehai's Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Zehai's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/09/25/2020-09-25-Jupyter/" class="post-title-link" itemprop="url">Jupyter</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2020-09-25 15:48:37" itemprop="dateCreated datePublished" datetime="2020-09-25T15:48:37+08:00">2020-09-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-04-07 22:34:12" itemprop="dateModified" datetime="2024-04-07T22:34:12+08:00">2024-04-07</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="what"><a href="#what" class="headerlink" title="what"></a>what</h1><p>Jupiter &#x3D; Julia + Python + R</p>
<blockquote>
<p>Jupyter notebookï¼ˆ<a href="https://link.zhihu.com/?target=http://jupyter.org/">http://jupyter.org/</a>ï¼‰ æ˜¯ä¸€ç§ Web åº”ç”¨ï¼Œèƒ½è®©ç”¨æˆ·å°†è¯´æ˜æ–‡æœ¬ã€æ•°å­¦æ–¹ç¨‹ã€ä»£ç å’Œå¯è§†åŒ–å†…å®¹å…¨éƒ¨ç»„åˆåˆ°ä¸€ä¸ªæ˜“äºå…±äº«çš„æ–‡æ¡£ä¸­ã€‚</p>
</blockquote>
<h1 id="why"><a href="#why" class="headerlink" title="why"></a>why</h1><ul>
<li>å°†ä»£ç å’Œæ–‡æ¡£ç»“åˆåœ¨ä¸€èµ·ï¼Œæ›´ç›´è§‚çš„ç¼–å†™äººå·¥æ™ºèƒ½ï¼Œå¤§æ•°æ®çš„ä»£ç </li>
<li>åˆ†å—è¿è¡Œ</li>
<li>ç›´æ¥è¿è¡Œshellä¸éœ€è¦åˆ‡æ¢ç¯å¢ƒ</li>
<li>so on</li>
</ul>
<h1 id="how"><a href="#how" class="headerlink" title="how"></a>how</h1><ol>
<li>Download images</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$docker pull jupyter jupyter/scipy-notebook:latest</span><br><span class="line">$docker run -itd --rm -p 1000:8888 -e JUPYTER_ENABLE_LAB=yes -v /home/zehai/jupyter:/home/jovyan/work --name jupyter jupyter/scipy-notebook:latest</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>docker logs -f  containerâ€™s ID and find token</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">To access the notebook, open this file in a browser:</span><br><span class="line">    file:///home/jovyan/.local/share/jupyter/runtime/nbserver-6-open.html</span><br><span class="line">Or copy and paste one of these URLs:</span><br><span class="line">    http://896bb1e66101:8888/?token=fda8565a9b5cd5b8c621b45322ee72f716fd7ddea089fb51</span><br><span class="line"> or http://127.0.0.1:8888/?token=fda8565a9b5cd5b8c621b45322ee72f716fd7ddea089fb51</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>more info visit official <a target="_blank" rel="noopener" href="https://jupyter-docker-stacks.readthedocs.io/en/latest/">docs</a></li>
<li>enjoy (pics powered by cherevero)</li>
</ol>
<p><img src="https://pics.tbjd.xyz/images/2020/09/25/3318a2fadaf085f2bee7f0de3b42971c.png" alt="3318a2fadaf085f2bee7f0de3b42971c.png"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/09/15/2020-09-15-Chevereto/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zehai's Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Zehai's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/09/15/2020-09-15-Chevereto/" class="post-title-link" itemprop="url">chevereto</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2020-09-15 10:16:33" itemprop="dateCreated datePublished" datetime="2020-09-15T10:16:33+08:00">2020-09-15</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-04-07 22:34:12" itemprop="dateModified" datetime="2024-04-07T22:34:12+08:00">2024-04-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Chevereto/" itemprop="url" rel="index"><span itemprop="name">Chevereto</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="what"><a href="#what" class="headerlink" title="what"></a>what</h1><p>To solve some problems</p>
<ul>
<li>some web only use markdown and canâ€™t upload pictures,such as v2ex.com</li>
<li>some pics you donâ€™t want to give it to others for long time,such as your interesting story </li>
<li>give your blogâ€™s  can speed when download bigger pics</li>
<li>and so on</li>
</ul>
<p>Picture Bed can offer you a excellent platform to share your pictures and protect them, however it has a problem that you need a server to run the service,even though  you can use ä¸ƒç‰›äº‘,alioss,weibo for free.</p>
<h1 id="why"><a href="#why" class="headerlink" title="why"></a>why</h1><p>Chevereto is aim what I find</p>
<ul>
<li>dockerhub has chevereto images</li>
<li>Combined with <a target="_blank" rel="noopener" href="https://getsharex.com/">ShareX</a> (only for windowsğŸ˜¢),chevereto can write markdown essay easily</li>
<li>it has api ,you can make it stronger</li>
<li>Chevereto Free v1.2.2 now</li>
<li>Something others you can discover by yourself</li>
</ul>
<h1 id="how"><a href="#how" class="headerlink" title="how"></a>how</h1><p>Chevereto is a php project , I use docker to run it </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">docker pull nmtan/chevereto:latest</span><br><span class="line"></span><br><span class="line">//use docker-compose.yml(next block)</span><br><span class="line"></span><br><span class="line">// or docker run </span><br><span class="line">docker run -it --name chevereto -d     -p 8000:80     -v &quot;/home/xxx/images&quot;:/var/www/html/images     -e &quot;CHEVERETO_DB_HOST=127.0.0.1&quot;     -e &quot;CHEVERETO_DB_USERNAME=root&quot;     -e &quot;CHEVERETO_DB_PASSWORD=rootpass&quot;     -e &quot;CHEVERETO_DB_NAME=chevereto&quot;     -e &quot;CHEVERETO_DB_PREFIX=chv_&quot;  nmtan/chevereto</span><br><span class="line">//-v save photos in server instead of container</span><br><span class="line">//-e mysql:5.7.31 host,username,password,db_name(db must exist first)</span><br><span class="line">//open chrome and input 127.0.0.1:8000</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">//this is docker-compose.yml</span><br><span class="line">version: &#x27;3&#x27;</span><br><span class="line"></span><br><span class="line">services:</span><br><span class="line">  db:</span><br><span class="line">    image: mariadb</span><br><span class="line">    volumes:</span><br><span class="line">      - ./database:/var/lib/mysql:rw</span><br><span class="line">    restart: always</span><br><span class="line">    networks:</span><br><span class="line">      - private</span><br><span class="line">    environment:</span><br><span class="line">      MYSQL_ROOT_PASSWORD: xxxxx</span><br><span class="line">      MYSQL_DATABASE: xxxxx</span><br><span class="line">      MYSQL_USER: xxxxx</span><br><span class="line">      MYSQL_PASSWORD: xxxxx</span><br><span class="line"></span><br><span class="line">  chevereto:</span><br><span class="line">    depends_on:</span><br><span class="line">      - db</span><br><span class="line">    image: nmtan/chevereto</span><br><span class="line">    restart: always</span><br><span class="line">    networks:</span><br><span class="line">      - private</span><br><span class="line">    environment:</span><br><span class="line">      CHEVERETO_DB_HOST: db</span><br><span class="line">      CHEVERETO_DB_USERNAME: xxxxxx</span><br><span class="line">      CHEVERETO_DB_PASSWORD: xxxxx</span><br><span class="line">      CHEVERETO_DB_NAME: xxxxx</span><br><span class="line">      CHEVERETO_DB_PREFIX: chv_</span><br><span class="line">    volumes:</span><br><span class="line">      - ./images:/var/www/html/images:rw</span><br><span class="line">      - ./php.ini:/usr/local/etc/php/php.ini:ro</span><br><span class="line">    ports:</span><br><span class="line">      - 8080:80</span><br><span class="line"></span><br><span class="line">networks:</span><br><span class="line">  private:</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// start command</span><br><span class="line">nohup docker-compose up  &amp;&gt; run.log &amp;</span><br><span class="line">disown</span><br></pre></td></tr></table></figure>



<p>You maybe run into a stone wall when you first visit 127.0.0.1:8000</p>
<ul>
<li><p>Before you can use <code>docker exec -it chevereto bash </code> into container &#x2F;var&#x2F;www&#x2F;html</p>
</li>
<li><p>no permission write phots to &#x2F;home&#x2F;xxx&#x2F;images,you can use <code>chmod -R 777 /home/xxx/images</code></p>
</li>
<li><p>no permission update chevereto from 1.1.4 to1.2.2 ,<code>no update possible: /app/install/update/temp/ path</code>,that is no temp folder in &#x2F;app&#x2F;install&#x2F;update&#x2F; under version 1.2.0,you can mkdir temp and then chmod -R 777 .&#x2F;temp and then refresh the webpage ,the prics bed will update successfully</p>
</li>
</ul>
<p>So , you can use ip address to visit your chevereto . However , we usually use domain name such as example.com to visit web, a https isn ecessary as well</p>
<ul>
<li>1.Use <a target="_blank" rel="noopener" href="https://yundunnext.console.aliyun.com/?spm=5176.2020520163.0.0.475556a7iLgQoU&p=cas">aliyun</a> to apply  a free ssl license for a domain name such as pics.example.com</li>
<li>2.Download pem and keys to your server and put it in nginx conf folder</li>
<li>3.Use the conf as follows</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">      listen 80;</span><br><span class="line">      server_name  pics.example.com;</span><br><span class="line">      return 301 https://pics.example.com$request_uri;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  server &#123;</span><br><span class="line">      listen 443 ssl;</span><br><span class="line">      server_name  pics.example.com;</span><br><span class="line">      gzip on;    </span><br><span class="line"></span><br><span class="line">      ssl_certificate cert/xxxxxx9_pics.example.com.pem; # pem&#x27;s filename</span><br><span class="line">      ssl_certificate_key cert/xxxxxx9_pics.example.com.key;# key&#x27;s filename</span><br><span class="line"></span><br><span class="line">      location / &#123;</span><br><span class="line">          proxy_redirect off;</span><br><span class="line">          proxy_pass http://dockername;</span><br><span class="line"></span><br><span class="line">          proxy_set_header  Host                $http_host;</span><br><span class="line">          proxy_set_header  X-Real-IP           $remote_addr;</span><br><span class="line">          proxy_set_header  X-Forwarded-Ssl     on;</span><br><span class="line">          proxy_set_header  X-Forwarded-For     $proxy_add_x_forwarded_for;</span><br><span class="line">          proxy_set_header  X-Forwarded-Proto   $scheme;</span><br><span class="line">          proxy_set_header  X-Frame-Options     SAMEORIGIN;</span><br><span class="line"></span><br><span class="line">          client_max_body_size        100m;</span><br><span class="line">          client_body_buffer_size     128k;</span><br><span class="line"></span><br><span class="line">          proxy_buffer_size           4k;</span><br><span class="line">          proxy_buffers               4 32k;</span><br><span class="line">          proxy_busy_buffers_size     64k;</span><br><span class="line">          proxy_temp_file_write_size  64k;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><ol start="4">
<li>And then you can visit <code>https://pics.example.com</code></li>
</ol>
</li>
</ul>
<p>Thatâ€˜s my story that building pics bed  ,and hope to help you.</p>
<p><code>2020-09-28 append</code></p>
<p>use <code>picgo</code>ï¼Œupload pictures in typora to chevereto</p>
<ol>
<li><p>GitHub download picgo,mac use <a target="_blank" rel="noopener" href="https://github.com/Molunerfinn/PicGo/releases/download/v2.3.0-beta.3/PicGo-2.3.0-beta.3.dmg">.dmp</a>,and then install it</p>
</li>
<li><p>open <code>æ’ä»¶è®¾ç½®</code>,search <code>chevereto</code> and install <code>chevereto 1.0.0</code></p>
</li>
<li><p>Open <code>å›¾åºŠè®¾ç½®&gt;Chevereto Uploader</code> and put in params,</p>
<p>Url is your upload service ip&#x2F;domain</p>
<p>Key is chevereto api in <code>Dashboard&gt;Settings&gt;API&gt;API v1 key</code></p>
<p>param is not in use now</p>
</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Url:https://example.com/api/1/upload</span><br><span class="line">Key:xxx</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>Click <code>ç¡®å®š</code> and <code>è®¾ä¸ºé»˜è®¤å›¾åº“</code></li>
<li>make sure server is on <code>PicGoè®¾ç½®&gt;è®¾ç½®Server&gt;ç‚¹å‡»è®¾ç½®</code>,if it is on ,noting should be done</li>
</ol>
<p>and then we modify config in typaro</p>
<ol>
<li>Open Typora and open â€˜preferences&gt;Images&#96; </li>
<li>Choose Upload images in when Insert and check <code>apply above rules to local images</code> and <code>apply above rules to online images</code> in option, and I suggest you check both of them to approve all pics managed by chevereto</li>
<li>Choose <code>PicGo.app</code> in images Uploader and click <code>Test Uploader</code> to test your upload pictures automatically</li>
</ol>
<p>for more information ,youcan visit </p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/Molunerfinn/PicGo">PicGo</a> and <a target="_blank" rel="noopener" href="https://picgo.github.io/PicGo-Core-Doc/">PicGo-Core</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_19564393/article/details/108506062">Upload your pictures in personal album instead of visitorsâ€™ albulm</a></li>
<li><a target="_blank" rel="noopener" href="https://v3-docs.chevereto.com/API/V1.html#api-key">Chevereto API</a></li>
</ul>
<h1 id="thanks"><a href="#thanks" class="headerlink" title="thanks"></a>thanks</h1><ul>
<li><a target="_blank" rel="noopener" href="https://chevereto.com/">Chevereto</a></li>
<li><a target="_blank" rel="noopener" href="https://getsharex.com/">ShareX</a></li>
<li><a target="_blank" rel="noopener" href="https://www.ioiox.com/archives/80.html">ioioxâ€™s blog</a></li>
<li><a target="_blank" rel="noopener" href="https://dana5haw.com/posts/Docker-Image-Hosting-Chevereto.html">dana5hawâ€™s blog</a></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/09/14/2020-09-14-RabbitMQ/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zehai's Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Zehai's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/09/14/2020-09-14-RabbitMQ/" class="post-title-link" itemprop="url">RabbitMQ</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2020-09-14 12:13:40" itemprop="dateCreated datePublished" datetime="2020-09-14T12:13:40+08:00">2020-09-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-04-07 22:34:12" itemprop="dateModified" datetime="2024-04-07T22:34:12+08:00">2024-04-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/MQ/" itemprop="url" rel="index"><span itemprop="name">MQ</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="what"><a href="#what" class="headerlink" title="what"></a>what</h1><p>MQ-message queue</p>
<p>ä¸‰è¶³é¼ç«‹</p>
<p>rocketmqâ€‹â€‹ -Made by Java ååé‡é«˜ä¸€äº› é˜¿é‡Œä¸­é—´ä»¶</p>
<p>rabbitmq -Made by Erlang</p>
<p>Kafka-</p>
<img  src="../img/mq.jpg" align='left'/>

<p>ä»¥åæœ‰æ›´å¤šçš„äº†è§£å†è¡¥å……æ€§èƒ½&#x2F;åŠŸèƒ½å·®è·</p>
<h1 id="why"><a href="#why" class="headerlink" title="why"></a>why</h1><p>åŠŸèƒ½ï¼šè§£è€¦(åŒæ–¹é€šè¿‡mqäº¤äº’)ã€å¼‚æ­¥ã€å‰Šå³°</p>
<p>åº”ç”¨ï¼š</p>
<ul>
<li>é˜¿é‡ŒåŒ11</li>
</ul>
<p>é—®é¢˜ï¼š</p>
<ul>
<li>å¤„ç†å¥½æ–°å¢çš„å¤æ‚æ€§</li>
<li>å¤„ç†å¥½ç³»ç»Ÿå¯ç”¨æ€§</li>
</ul>
<h1 id="how"><a href="#how" class="headerlink" title="how"></a>how</h1><p>ä¹‹æ‰€ä»¥é€‰æ‹©rabbitmqæ˜¯å› ä¸ºrocketmqçš„nameserveræ‰€éœ€è¦çš„å†…å­˜å¤ªå¤§äº†ï¼Œæ›´ä½•å†µbokerï¼Œå¯¹äº1C2Gçš„ä¹ä¸æœºå™¨æ¥è¯´æ ¹æœ¬è·‘ä¸èµ·æ¥</p>
<h2 id="1-docker-run"><a href="#1-docker-run" class="headerlink" title="1.docker run"></a>1.docker run</h2><p>Because of rocketmq need more than </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">docker pull rabbitmq:management</span><br><span class="line"></span><br><span class="line">docker run -dit --name rabbitmq -e RABBITMQ_DEFAULT_USER=admin -e RABBITMQ_DEFAULT_PASS=admin -p 15672:15672 -p 5672:5672 rabbitmq:management</span><br><span class="line"></span><br><span class="line">--name containername</span><br><span class="line">-e RABBITMQ_DEFAULT_USER å‚æ•°ç”¨æˆ·åï¼Œå¯†ç åŒç†</span><br><span class="line">-p ç«¯å£æ˜ å°„ï¼Œä¸»æœºï¼šå®¹å™¨ï¼Œ15672-UIï¼Œ5672-service</span><br><span class="line">rabbitmq:management image&#x27;s name</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="2-Usage"><a href="#2-Usage" class="headerlink" title="2.Usage"></a>2.Usage</h2><p>1.open chrome and input â€˜localhost:15672â€™ or â€˜192.168.1.1:15672â€™ then you can touch rabbitmq UI</p>
<p>Overviewâ€“the queued msg, msg rate in your server,  some global counts, your nodes stats (if u use the above method,you only see one node in the screen ),you also can build a cluster with more nodes</p>
<p>Connectionsâ€“</p>
<p>Channelsâ€“</p>
<p>Exchangesâ€“direct,fanout,headers,match,trace,topic</p>
<p>Quesesâ€“</p>
<p>Adminâ€“users management with passport &amp;&amp; permission</p>
<p>2.use 5672 in your code</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">amqp.<span class="title function_">connect</span>(&#123;</span><br><span class="line">            <span class="attr">protocol</span>: <span class="string">&#x27;amqp&#x27;</span>,</span><br><span class="line">            <span class="attr">hostname</span>: <span class="string">&#x27;example.com&#x27;</span>,<span class="comment">//localhost</span></span><br><span class="line">            <span class="attr">port</span>: <span class="string">&#x27;5672&#x27;</span>,</span><br><span class="line">            <span class="attr">username</span>: <span class="string">&#x27;admin&#x27;</span>,</span><br><span class="line">            <span class="attr">password</span>: <span class="string">&#x27;xxx&#x27;</span>,</span><br><span class="line">            <span class="attr">vhost</span>: <span class="string">&#x27;/&#x27;</span>,<span class="comment">//important</span></span><br><span class="line">        &#125;)</span><br></pre></td></tr></table></figure>

<p>more in official docsâ€“&gt;<a target="_blank" rel="noopener" href="https://www.rabbitmq.com/tutorials/tutorial-one-javascript.html"> Iâ€™m doc</a></p>
<p>or some blogsâ€“&gt;<a target="_blank" rel="noopener" href="https://www.cnblogs.com/wukong-holmes/p/9306733.html">Iâ€™m blog</a></p>
<p>or my GitHubâ€“&gt;<a target="_blank" rel="noopener" href="https://github.com/ShawnGoethe/phones/tree/master/app/controller/pmq.js">click here</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/07/24/2020-07-23-EventLoop2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zehai's Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Zehai's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/07/24/2020-07-23-EventLoop2/" class="post-title-link" itemprop="url">EventLoop Source</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2020-07-24 11:49:24" itemprop="dateCreated datePublished" datetime="2020-07-24T11:49:24+08:00">2020-07-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-04-07 22:34:12" itemprop="dateModified" datetime="2024-04-07T22:34:12+08:00">2024-04-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Node/" itemprop="url" rel="index"><span itemprop="name">Node</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="eventLoop"><a href="#eventLoop" class="headerlink" title="eventLoop"></a>eventLoop</h1><p>ä¹‹å‰ä¹Ÿæœ‰è¿‡ç« èŠ‚<br><a href="/2020/04/10/2020-04-10-eventloop/">nodeæ•´ç†</a><br><a href="/Nodejs/">Node.js</a></p>
<p>æœ‰çœ‹åˆ°<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/34182184">çŸ³å¢¨æŠ€æœ¯æ–‡æ¡£</a></p>
<p><a target="_blank" rel="noopener" href="https://cnodejs.org/topic/5a9108d78d6e16e56bb80882">cnodeæŠ€æœ¯æ–‡æ¡£</a>ï¼Œä½œè€…ï¼šyouth7</p>
<p>è®°å½•ä»¥ä¸‹çŸ¥è¯†ç‚¹ï¼š</p>
<ul>
<li><strong>nodejsçš„eventæ˜¯åŸºäºlibuv</strong>ï¼Œ<strong>æµè§ˆå™¨çš„event loopåˆ™åœ¨<a target="_blank" rel="noopener" href="https://www.w3.org/TR/html5/webappapis.html#event-loops">html5çš„è§„èŒƒ</a>ä¸­æ˜ç¡®å®šä¹‰</strong>ï¼Œä¸¤ä¸ªäº‹ç‰©æœ‰æ˜æ˜¾çš„åŒºåˆ«</li>
<li><code>process.nextTick()</code>åœ¨6ä¸ªé˜¶æ®µç»“æŸçš„æ—¶å€™éƒ½ä¼šæ‰§è¡Œ</li>
</ul>
<h2 id="eventLoop-1"><a href="#eventLoop-1" class="headerlink" title="eventLoop"></a>eventLoop</h2><table>
<thead>
<tr>
<th>timers</th>
<th>æ‰§è¡Œ<code>setTimeout()</code> å’Œ <code>setInterval()</code>ä¸­åˆ°æœŸçš„callback</th>
</tr>
</thead>
<tbody><tr>
<td>I&#x2F;O callbacks</td>
<td>ä¸Šä¸€è½®å¾ªç¯ä¸­æœ‰å°‘æ•°çš„I&#x2F;Ocallbackä¼šè¢«å»¶è¿Ÿåˆ°è¿™ä¸€è½®çš„è¿™ä¸€é˜¶æ®µæ‰§è¡Œ</td>
</tr>
<tr>
<td>idle, prepare</td>
<td>ä»…å†…éƒ¨ä½¿ç”¨</td>
</tr>
<tr>
<td>poll</td>
<td>æœ€ä¸ºé‡è¦çš„é˜¶æ®µï¼Œæ‰§è¡ŒI&#x2F;O callbackï¼Œåœ¨é€‚å½“çš„æ¡ä»¶ä¸‹ä¼šé˜»å¡åœ¨è¿™ä¸ªé˜¶æ®µ</td>
</tr>
<tr>
<td>check</td>
<td>æ‰§è¡ŒsetImmediateçš„callback</td>
</tr>
<tr>
<td>close callbacks</td>
<td>æ‰§è¡Œcloseäº‹ä»¶çš„callbackï¼Œä¾‹å¦‚<code>socket.on(&quot;close&quot;,func)</code></td>
</tr>
</tbody></table>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">â”Œâ”€&gt;â”‚        timers         â”‚</span><br><span class="line">â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br><span class="line">â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">â”‚  â”‚     I/O callbacks     â”‚</span><br><span class="line">â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br><span class="line">â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">â”‚  â”‚     idle, prepare     â”‚</span><br><span class="line">â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚   incoming:   â”‚</span><br><span class="line">â”‚  â”‚         poll          â”‚&lt;â”€â”€â”€â”€â”€â”¤  connections, â”‚</span><br><span class="line">â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚   data, etc.  â”‚</span><br><span class="line">â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br><span class="line">â”‚  â”‚        check          â”‚</span><br><span class="line">â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br><span class="line">â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">â””â”€â”€â”¤    close callbacks    â”‚</span><br><span class="line">   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br></pre></td></tr></table></figure>



<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"># /deps/uv/src/unix/core.<span class="function">c</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">uv_run</span><span class="params">(<span class="type">uv_loop_t</span>* loop, uv_run_mode mode)</span> </span>&#123;</span><br><span class="line">  <span class="type">int</span> timeout;</span><br><span class="line">  <span class="type">int</span> r;</span><br><span class="line">  <span class="type">int</span> ran_pending;</span><br><span class="line"></span><br><span class="line">  r = <span class="built_in">uv__loop_alive</span>(loop);</span><br><span class="line">  <span class="comment">// if(uv_has_active_hanles||uv_has_active_reqs || lop-&gt;closing_handles!=NULL)retrun true </span></span><br><span class="line">  <span class="keyword">if</span> (!r)</span><br><span class="line">    <span class="built_in">uv__update_time</span>(loop);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span> (r != <span class="number">0</span> &amp;&amp; loop-&gt;stop_flag == <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="built_in">uv__update_time</span>(loop);</span><br><span class="line">    <span class="comment">// main</span></span><br><span class="line">    <span class="built_in">uv__run_timers</span>(loop);<span class="comment">//timer phase</span></span><br><span class="line">    ran_pending = <span class="built_in">uv__run_pending</span>(loop);<span class="comment">//IO callback pharse</span></span><br><span class="line">    <span class="built_in">uv__run_idle</span>(loop);<span class="comment">//idle phase</span></span><br><span class="line">    <span class="built_in">uv__run_prepare</span>(loop);<span class="comment">// prepare phase</span></span><br><span class="line">    <span class="comment">// main end</span></span><br><span class="line"></span><br><span class="line">    timeout = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> ((mode == UV_RUN_ONCE &amp;&amp; !ran_pending) || mode == UV_RUN_DEFAULT)</span><br><span class="line">      timeout = <span class="built_in">uv_backend_timeout</span>(loop);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">uv__io_poll</span>(loop, timeout);<span class="comment">//poll phase</span></span><br><span class="line">    <span class="built_in">uv__run_check</span>(loop);<span class="comment">//check phase</span></span><br><span class="line">    <span class="built_in">uv__run_closing_handles</span>(loop);<span class="comment">//closing pharse</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (mode == UV_RUN_ONCE) &#123;</span><br><span class="line">      <span class="comment">/* UV_RUN_ONCE implies forward progress: at least one callback must have</span></span><br><span class="line"><span class="comment">       * been invoked when it returns. uv__io_poll() can return without doing</span></span><br><span class="line"><span class="comment">       * I/O (meaning: no callbacks) when its timeout expires - which means we</span></span><br><span class="line"><span class="comment">       * have pending timers that satisfy the forward progress constraint.</span></span><br><span class="line"><span class="comment">       *</span></span><br><span class="line"><span class="comment">       * UV_RUN_NOWAIT makes no guarantees about progress so it&#x27;s omitted from</span></span><br><span class="line"><span class="comment">       * the check.</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="comment">// UV_RUN_ONCE è‡³å°‘æœ‰ä¸€ä¸ªå›è°ƒæ‰§è¡Œ,ä¸ç„¶è¯¥å¾ªç¯å°±ç©ºè½¬äº†ï¼Œæ»¡è¶³å‰è¿›è¦æ±‚</span></span><br><span class="line">      <span class="comment">// è¿™ä¹Ÿæ˜¯[æ–‡ç« ](https://zehai.info/2020/04/10/2020-04-10-eventloop/)ä¸­å†™åˆ°ï¼š</span></span><br><span class="line">      <span class="comment">// pollä¸ºç©ºï¼Œeventloopå°†æ£€æŸ¥timeræ˜¯å¦æœ‰å¿«åˆ°çš„ï¼Œå¦‚æœéœ€è¦æ‰§è¡Œï¼Œeventloopå°†è¦è¿›å…¥timersé˜¶æ®µæ¥é¡ºåºæ‰§è¡Œtimer callback</span></span><br><span class="line">      <span class="built_in">uv__update_time</span>(loop);</span><br><span class="line">      <span class="built_in">uv__run_timers</span>(loop);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    r = <span class="built_in">uv__loop_alive</span>(loop);</span><br><span class="line">    <span class="keyword">if</span> (mode == UV_RUN_ONCE || mode == UV_RUN_NOWAIT)</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* The if statement lets gcc compile it to a conditional store. Avoids</span></span><br><span class="line"><span class="comment">   * dirtying a cache line.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">if</span> (loop-&gt;stop_flag != <span class="number">0</span>)</span><br><span class="line">    loop-&gt;stop_flag = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> r;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="timers-phase"><a href="#timers-phase" class="headerlink" title="timers phase"></a>timers phase</h2><p>æ‰§è¡Œ<code>setTimeout()</code> å’Œ <code>setInterval()</code>ä¸­åˆ°æœŸçš„callback</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">uv__run_timers</span><span class="params">(<span class="type">uv_loop_t</span>* loop)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">struct</span> <span class="title class_">heap_node</span>* heap_node;</span><br><span class="line">  <span class="type">uv_timer_t</span>* handle;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">    heap_node = <span class="built_in">heap_min</span>(<span class="built_in">timer_heap</span>(loop));</span><br><span class="line">    <span class="keyword">if</span> (heap_node == <span class="literal">NULL</span>)</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">		<span class="comment">// å–å‡ºå †ä¸­æœ€å¿«è¦è¢«æ‰§è¡Œçš„timer</span></span><br><span class="line">    <span class="comment">// #define container_of(ptr, type, member) </span></span><br><span class="line">  	<span class="comment">// ((type *) ((char *) (ptr) - offsetof(type, member)))</span></span><br><span class="line">    <span class="comment">// æ²¡çœ‹æ‡‚ handleæ˜¯æ€ä¹ˆç”Ÿæˆçš„</span></span><br><span class="line">    handle = <span class="built_in">container_of</span>(heap_node, <span class="type">uv_timer_t</span>, heap_node);</span><br><span class="line">    <span class="keyword">if</span> (handle-&gt;timeout &gt; loop-&gt;time)<span class="comment">//æ‰§è¡Œæ—¶é—´å¤§äºeventloopå¾ªç¯ä¸€æ¬¡æ—¶é—´ï¼Œé€€å‡ºphaseä¸‹æ¬¡å†è¯´</span></span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">uv_timer_stop</span>(handle);<span class="comment">// remove handle</span></span><br><span class="line">    <span class="built_in">uv_timer_again</span>(handle);<span class="comment">// å¤šæ¬¡é‡å¤çš„timerå†å¡è¿›å»</span></span><br><span class="line">    handle-&gt;<span class="built_in">timer_cb</span>(handle);<span class="comment">// invoke callback</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="I-O-callbacks"><a href="#I-O-callbacks" class="headerlink" title="I&#x2F;O callbacks"></a>I&#x2F;O callbacks</h2><p>ä¸Šä¸€è½®å¾ªç¯ä¸­æœ‰å°‘æ•°çš„I&#x2F;Ocallbackä¼šè¢«å»¶è¿Ÿåˆ°è¿™ä¸€è½®çš„è¿™ä¸€é˜¶æ®µæ‰§è¡Œ</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//deps/uv/src/unix/core.c</span></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">int</span> <span class="title">uv__run_pending</span><span class="params">(<span class="type">uv_loop_t</span>* loop)</span> </span>&#123;</span><br><span class="line">  QUEUE* q;</span><br><span class="line">  QUEUE pq;</span><br><span class="line">  <span class="type">uv__io_t</span>* w;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">QUEUE_EMPTY</span>(&amp;loop-&gt;pending_queue))<span class="comment">//isEmpty</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">QUEUE_MOVE</span>(&amp;loop-&gt;pending_queue, &amp;pq);<span class="comment">//move</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span> (!<span class="built_in">QUEUE_EMPTY</span>(&amp;pq)) &#123;</span><br><span class="line">    q = <span class="built_in">QUEUE_HEAD</span>(&amp;pq);<span class="comment">//find</span></span><br><span class="line">    <span class="built_in">QUEUE_REMOVE</span>(q);<span class="comment">//pop</span></span><br><span class="line">    <span class="built_in">QUEUE_INIT</span>(q);</span><br><span class="line">    w = <span class="built_in">QUEUE_DATA</span>(q, <span class="type">uv__io_t</span>, pending_queue);</span><br><span class="line">    w-&gt;<span class="built_in">cb</span>(loop, w, POLLOUT);<span class="comment">//unitl queue empty</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Idle-and-prepare-phase"><a href="#Idle-and-prepare-phase" class="headerlink" title="Idle and prepare phase"></a>Idle and prepare phase</h2><p>&#x2F;* loop *&#x2F;</p>
<p>void uv__run_idle(uv_loop_t* loop);</p>
<p>void uv__run_check(uv_loop_t* loop);</p>
<p>void uv__run_prepare(uv_loop_t* loop);</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> uv__run_#<span class="meta">#name(uv_loop_t* loop) &#123;</span></span><br><span class="line">  uv_#<span class="meta">#name##_t* h;</span></span><br><span class="line">  QUEUE queue;</span><br><span class="line">  QUEUE* q;</span><br><span class="line">  <span class="built_in">QUEUE_MOVE</span>(&amp;loop-&gt;name##_handles, &amp;queue);<span class="comment">//QUEUE_MOVE</span></span><br><span class="line">  <span class="keyword">while</span> (!<span class="built_in">QUEUE_EMPTY</span>(&amp;queue)) &#123;<span class="comment">//util empty</span></span><br><span class="line">    q = <span class="built_in">QUEUE_HEAD</span>(&amp;queue);<span class="comment">//pop</span></span><br><span class="line">    h = <span class="built_in">QUEUE_DATA</span>(q, uv_#<span class="meta">#name##_t, queue);<span class="comment">//element-&gt;handle</span></span></span><br><span class="line">    <span class="built_in">QUEUE_REMOVE</span>(q);<span class="comment">//remove</span></span><br><span class="line">    <span class="built_in">QUEUE_INSERT_TAIL</span>(&amp;loop-&gt;name##_handles, q);<span class="comment">//insert tail</span></span><br><span class="line">    h-&gt;name##_cb(h);<span class="comment">//callback</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;   </span><br></pre></td></tr></table></figure>



<h2 id="poll-phase"><a href="#poll-phase" class="headerlink" title="!!!poll phase!!!"></a>!!!poll phase!!!</h2><p>æœ€ä¸ºé‡è¦çš„é˜¶æ®µï¼Œæ‰§è¡ŒI&#x2F;O callbackï¼Œåœ¨é€‚å½“çš„æ¡ä»¶ä¸‹ä¼šé˜»å¡åœ¨è¿™ä¸ªé˜¶æ®µ</p>
<blockquote>
<p>å¯è§pollé˜¶æ®µçš„ä»»åŠ¡å°±æ˜¯é˜»å¡ç­‰å¾…ç›‘å¬çš„äº‹ä»¶æ¥ä¸´ï¼Œç„¶åæ‰§è¡Œå¯¹åº”çš„callbackï¼Œå…¶ä¸­é˜»å¡æ˜¯å¸¦æœ‰è¶…æ—¶æ—¶é—´çš„ï¼Œä»¥ä¸‹å‡ ç§æƒ…å†µéƒ½ä¼šä½¿å¾—è¶…æ—¶æ—¶é—´ä¸º0</p>
<ul>
<li>uv_runå¤„äºUV_RUN_NOWAITæ¨¡å¼ä¸‹</li>
<li><code>uv_stop()</code>è¢«è°ƒç”¨</li>
<li>æ²¡æœ‰æ´»è·ƒçš„handleså’Œrequest</li>
<li>æœ‰æ´»è·ƒçš„idle handles</li>
<li>æœ‰ç­‰å¾…å…³é—­çš„handles</li>
</ul>
<p>å¦‚æœä¸Šè¿°éƒ½ä¸ç¬¦åˆï¼Œåˆ™è¶…æ—¶æ—¶é—´ä¸ºè·ç¦»ç°åœ¨æœ€è¿‘çš„timerï¼›å¦‚æœæ²¡æœ‰timeråˆ™pollé˜¶æ®µä¼šä¸€ç›´é˜»å¡ä¸‹å»</p>
</blockquote>
<p>ä¸ªäººç†è§£nodejsçš„æœåŠ¡ï¼Œå¤§éƒ¨åˆ†æ—¶é—´ä¼šè¢«é˜»å¡åœ¨è¿™ä¸ªé˜¶æ®µï¼Œè€Œä¸å»æ‰§è¡Œclosing</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¸è¡Œäº†ï¼Œçœ‹ä¸æ‡‚äº†</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">uv__io_poll</span><span class="params">(<span class="type">uv_loop_t</span>* loop, <span class="type">int</span> timeout)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">struct</span> <span class="title class_">pollfd</span> events[<span class="number">1024</span>];</span><br><span class="line">  <span class="keyword">struct</span> <span class="title class_">pollfd</span> pqry;</span><br><span class="line">  <span class="keyword">struct</span> <span class="title class_">pollfd</span>* pe;</span><br><span class="line">  <span class="keyword">struct</span> <span class="title class_">poll_ctl</span> pc;</span><br><span class="line">  QUEUE* q;</span><br><span class="line">  <span class="type">uv__io_t</span>* w;</span><br><span class="line">  <span class="type">uint64_t</span> base;</span><br><span class="line">  <span class="type">uint64_t</span> diff;</span><br><span class="line">  <span class="type">int</span> have_signals;</span><br><span class="line">  <span class="type">int</span> nevents;</span><br><span class="line">  <span class="type">int</span> count;</span><br><span class="line">  <span class="type">int</span> nfds;</span><br><span class="line">  <span class="type">int</span> i;</span><br><span class="line">  <span class="type">int</span> rc;</span><br><span class="line">  <span class="type">int</span> add_failed;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (loop-&gt;nfds == <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="built_in">assert</span>(<span class="built_in">QUEUE_EMPTY</span>(&amp;loop-&gt;watcher_queue));</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span> (!<span class="built_in">QUEUE_EMPTY</span>(&amp;loop-&gt;watcher_queue)) &#123;<span class="comment">//until watcher queue empty</span></span><br><span class="line">    q = <span class="built_in">QUEUE_HEAD</span>(&amp;loop-&gt;watcher_queue);</span><br><span class="line">    <span class="built_in">QUEUE_REMOVE</span>(q);</span><br><span class="line">    <span class="built_in">QUEUE_INIT</span>(q);</span><br><span class="line"></span><br><span class="line">    w = <span class="built_in">QUEUE_DATA</span>(q, <span class="type">uv__io_t</span>, watcher_queue);</span><br><span class="line">    <span class="built_in">assert</span>(w-&gt;pevents != <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">assert</span>(w-&gt;fd &gt;= <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">assert</span>(w-&gt;fd &lt; (<span class="type">int</span>) loop-&gt;nwatchers);</span><br><span class="line"></span><br><span class="line">    pc.events = w-&gt;pevents;</span><br><span class="line">    pc.fd = w-&gt;fd;</span><br><span class="line"></span><br><span class="line">    add_failed = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (w-&gt;events == <span class="number">0</span>) &#123;</span><br><span class="line">      pc.cmd = PS_ADD;</span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">pollset_ctl</span>(loop-&gt;backend_fd, &amp;pc, <span class="number">1</span>)) &#123;</span><br><span class="line">        <span class="keyword">if</span> (errno != EINVAL) &#123;</span><br><span class="line">          <span class="built_in">assert</span>(<span class="number">0</span> &amp;&amp; <span class="string">&quot;Failed to add file descriptor (pc.fd) to pollset&quot;</span>);</span><br><span class="line">          <span class="built_in">abort</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">/* Check if the fd is already in the pollset */</span></span><br><span class="line">        pqry.fd = pc.fd;</span><br><span class="line">        rc = <span class="built_in">pollset_query</span>(loop-&gt;backend_fd, &amp;pqry);</span><br><span class="line">        <span class="keyword">switch</span> (rc) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">-1</span>:</span><br><span class="line">          <span class="built_in">assert</span>(<span class="number">0</span> &amp;&amp; <span class="string">&quot;Failed to query pollset for file descriptor&quot;</span>);</span><br><span class="line">          <span class="built_in">abort</span>();</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">          <span class="built_in">assert</span>(<span class="number">0</span> &amp;&amp; <span class="string">&quot;Pollset does not contain file descriptor&quot;</span>);</span><br><span class="line">          <span class="built_in">abort</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">/* If we got here then the pollset already contained the file descriptor even though</span></span><br><span class="line"><span class="comment">         * we didn&#x27;t think it should. This probably shouldn&#x27;t happen, but we can continue. */</span></span><br><span class="line">        add_failed = <span class="number">1</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (w-&gt;events != <span class="number">0</span> || add_failed) &#123;</span><br><span class="line">      <span class="comment">/* Modify, potentially removing events -- need to delete then add.</span></span><br><span class="line"><span class="comment">       * Could maybe mod if we knew for sure no events are removed, but</span></span><br><span class="line"><span class="comment">       * content of w-&gt;events is handled above as not reliable (falls back)</span></span><br><span class="line"><span class="comment">       * so may require a pollset_query() which would have to be pretty cheap</span></span><br><span class="line"><span class="comment">       * compared to a PS_DELETE to be worth optimizing. Alternatively, could</span></span><br><span class="line"><span class="comment">       * lazily remove events, squelching them in the mean time. */</span></span><br><span class="line">      pc.cmd = PS_DELETE;</span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">pollset_ctl</span>(loop-&gt;backend_fd, &amp;pc, <span class="number">1</span>)) &#123;</span><br><span class="line">        <span class="built_in">assert</span>(<span class="number">0</span> &amp;&amp; <span class="string">&quot;Failed to delete file descriptor (pc.fd) from pollset&quot;</span>);</span><br><span class="line">        <span class="built_in">abort</span>();</span><br><span class="line">      &#125;</span><br><span class="line">      pc.cmd = PS_ADD;</span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">pollset_ctl</span>(loop-&gt;backend_fd, &amp;pc, <span class="number">1</span>)) &#123;</span><br><span class="line">        <span class="built_in">assert</span>(<span class="number">0</span> &amp;&amp; <span class="string">&quot;Failed to add file descriptor (pc.fd) to pollset&quot;</span>);</span><br><span class="line">        <span class="built_in">abort</span>();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    w-&gt;events = w-&gt;pevents;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">assert</span>(timeout &gt;= <span class="number">-1</span>);</span><br><span class="line">  base = loop-&gt;time;</span><br><span class="line">  count = <span class="number">48</span>; <span class="comment">/* Benchmarks suggest this gives the best throughput. */</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">    nfds = <span class="built_in">pollset_poll</span>(loop-&gt;backend_fd,</span><br><span class="line">                        events,</span><br><span class="line">                        <span class="built_in">ARRAY_SIZE</span>(events),</span><br><span class="line">                        timeout);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Update loop-&gt;time unconditionally. It&#x27;s tempting to skip the update when</span></span><br><span class="line"><span class="comment">     * timeout == 0 (i.e. non-blocking poll) but there is no guarantee that the</span></span><br><span class="line"><span class="comment">     * operating system didn&#x27;t reschedule our process while in the syscall.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="built_in">SAVE_ERRNO</span>(<span class="built_in">uv__update_time</span>(loop));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (nfds == <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="built_in">assert</span>(timeout != <span class="number">-1</span>);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (nfds == <span class="number">-1</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (errno != EINTR) &#123;</span><br><span class="line">        <span class="built_in">abort</span>();</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (timeout == <span class="number">-1</span>)</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (timeout == <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/* Interrupted by a signal. Update timeout and poll again. */</span></span><br><span class="line">      <span class="keyword">goto</span> update_timeout;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    have_signals = <span class="number">0</span>;</span><br><span class="line">    nevents = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">assert</span>(loop-&gt;watchers != <span class="literal">NULL</span>);</span><br><span class="line">    loop-&gt;watchers[loop-&gt;nwatchers] = (<span class="type">void</span>*) events;</span><br><span class="line">    loop-&gt;watchers[loop-&gt;nwatchers + <span class="number">1</span>] = (<span class="type">void</span>*) (<span class="type">uintptr_t</span>) nfds;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; nfds; i++) &#123;</span><br><span class="line">      pe = events + i;</span><br><span class="line">      pc.cmd = PS_DELETE;</span><br><span class="line">      pc.fd = pe-&gt;fd;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/* Skip invalidated events, see uv__platform_invalidate_fd */</span></span><br><span class="line">      <span class="keyword">if</span> (pc.fd == <span class="number">-1</span>)</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">      <span class="built_in">assert</span>(pc.fd &gt;= <span class="number">0</span>);</span><br><span class="line">      <span class="built_in">assert</span>((<span class="type">unsigned</span>) pc.fd &lt; loop-&gt;nwatchers);</span><br><span class="line"></span><br><span class="line">      w = loop-&gt;watchers[pc.fd];</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (w == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="comment">/* File descriptor that we&#x27;ve stopped watching, disarm it.</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         * Ignore all errors because we may be racing with another thread</span></span><br><span class="line"><span class="comment">         * when the file descriptor is closed.</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="built_in">pollset_ctl</span>(loop-&gt;backend_fd, &amp;pc, <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/* Run signal watchers last.  This also affects child process watchers</span></span><br><span class="line"><span class="comment">       * because those are implemented in terms of signal watchers.</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="keyword">if</span> (w == &amp;loop-&gt;signal_io_watcher)</span><br><span class="line">        have_signals = <span class="number">1</span>;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">        w-&gt;<span class="built_in">cb</span>(loop, w, pe-&gt;revents);</span><br><span class="line"></span><br><span class="line">      nevents++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (have_signals != <span class="number">0</span>)</span><br><span class="line">      loop-&gt;signal_io_watcher.<span class="built_in">cb</span>(loop, &amp;loop-&gt;signal_io_watcher, POLLIN);</span><br><span class="line"></span><br><span class="line">    loop-&gt;watchers[loop-&gt;nwatchers] = <span class="literal">NULL</span>;</span><br><span class="line">    loop-&gt;watchers[loop-&gt;nwatchers + <span class="number">1</span>] = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (have_signals != <span class="number">0</span>)</span><br><span class="line">      <span class="keyword">return</span>;  <span class="comment">/* Event loop should cycle now so don&#x27;t poll again. */</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (nevents != <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (nfds == <span class="built_in">ARRAY_SIZE</span>(events) &amp;&amp; --count != <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">/* Poll for more events but don&#x27;t block this time. */</span></span><br><span class="line">        timeout = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (timeout == <span class="number">0</span>)</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (timeout == <span class="number">-1</span>)</span><br><span class="line">      <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">update_timeout:</span><br><span class="line">    <span class="built_in">assert</span>(timeout &gt; <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    diff = loop-&gt;time - base;</span><br><span class="line">    <span class="keyword">if</span> (diff &gt;= (<span class="type">uint64_t</span>) timeout)</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    timeout -= diff;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="check-phase"><a href="#check-phase" class="headerlink" title="check phase"></a>check phase</h2><p>è§idle prepare</p>
<h2 id="close"><a href="#close" class="headerlink" title="close"></a>close</h2><p>å…³é—­handle</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">uv__run_closing_handles</span><span class="params">(<span class="type">uv_loop_t</span>* loop)</span> </span>&#123;</span><br><span class="line">  <span class="type">uv_handle_t</span>* p;</span><br><span class="line">  <span class="type">uv_handle_t</span>* q;</span><br><span class="line"></span><br><span class="line">  p = loop-&gt;closing_handles;</span><br><span class="line">  loop-&gt;closing_handles = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span> (p) &#123;</span><br><span class="line">    q = p-&gt;next_closing;</span><br><span class="line">    <span class="built_in">uv__finish_close</span>(p);</span><br><span class="line">    p = q;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="where-is-process-nextTick"><a href="#where-is-process-nextTick" class="headerlink" title="where is process.nextTick"></a>where is process.nextTick</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//lib/internal/process/task_queues.js</span></span><br><span class="line"><span class="comment">// `nextTick()` will not enqueue any callback when the process is about to</span></span><br><span class="line"><span class="comment">// exit since the callback would not have a chance to be executed.</span></span><br><span class="line"><span class="comment">// æ„æ€å°±æ˜¯nextTickåœ¨è¿›ç¨‹å¿«è¦ç»“æŸæ—¶ä¸ä¼šæ’é˜Ÿcallback,å› ä¸ºæ²¡æœ‰æœºä¼šæ‰§è¡Œ</span></span><br><span class="line"><span class="comment">// ä½ ä»¬çœ‹å¼•ç”¨çš„æ–‡æ¡£å§ï¼Œæˆ‘çœ‹ä¸ä¸‹å»äº†ğŸ˜­</span></span><br><span class="line"><span class="comment">// ä¸»è¦çš„æ€è·¯æ˜¯JSæ‰§è¡Œprocess.nexTick()ï¼Œç„¶åå°†callbackäº¤ç»™c++æ‰§è¡Œ</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">nextTick</span>(<span class="params">callback</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> callback !== <span class="string">&#x27;function&#x27;</span>)</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title function_">ERR_INVALID_CALLBACK</span>(callback);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (process.<span class="property">_exiting</span>)</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> args;</span><br><span class="line">  <span class="keyword">switch</span> (<span class="variable language_">arguments</span>.<span class="property">length</span>) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">1</span>: <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">2</span>: args = [<span class="variable language_">arguments</span>[<span class="number">1</span>]]; <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">3</span>: args = [<span class="variable language_">arguments</span>[<span class="number">1</span>], <span class="variable language_">arguments</span>[<span class="number">2</span>]]; <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">4</span>: args = [<span class="variable language_">arguments</span>[<span class="number">1</span>], <span class="variable language_">arguments</span>[<span class="number">2</span>], <span class="variable language_">arguments</span>[<span class="number">3</span>]]; <span class="keyword">break</span>;</span><br><span class="line">    <span class="attr">default</span>:</span><br><span class="line">      args = <span class="keyword">new</span> <span class="title class_">Array</span>(<span class="variable language_">arguments</span>.<span class="property">length</span> - <span class="number">1</span>);</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">1</span>; i &lt; <span class="variable language_">arguments</span>.<span class="property">length</span>; i++)</span><br><span class="line">        args[i - <span class="number">1</span>] = <span class="variable language_">arguments</span>[i];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (queue.<span class="title function_">isEmpty</span>())</span><br><span class="line">    <span class="title function_">setHasTickScheduled</span>(<span class="literal">true</span>);</span><br><span class="line">  <span class="keyword">const</span> asyncId = <span class="title function_">newAsyncId</span>();</span><br><span class="line">  <span class="keyword">const</span> triggerAsyncId = <span class="title function_">getDefaultTriggerAsyncId</span>();</span><br><span class="line">  <span class="keyword">const</span> tickObject = &#123;</span><br><span class="line">    [async_id_symbol]: asyncId,</span><br><span class="line">    [trigger_async_id_symbol]: triggerAsyncId,</span><br><span class="line">    callback,</span><br><span class="line">    args</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_">initHooksExist</span>())</span><br><span class="line">    <span class="title function_">emitInit</span>(asyncId, <span class="string">&#x27;TickObject&#x27;</span>, triggerAsyncId, tickObject);</span><br><span class="line">  queue.<span class="title function_">push</span>(tickObject);<span class="comment">//å°è£…callback push</span></span><br><span class="line">  <span class="comment">//è¿›å…¥c</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="question"><a href="#question" class="headerlink" title="question"></a>question</h2><h3 id="1-setTimeout-vs-setImmediate"><a href="#1-setTimeout-vs-setImmediate" class="headerlink" title="1.setTimeout vs setImmediate"></a>1.setTimeout vs setImmediate</h3><ul>
<li>phaseæ‰§è¡Œé¡ºåº</li>
<li>expireè®¾ç½®0æ˜¯ä¸æ˜¯ç«‹åˆ»æ‰§è¡Œ</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;setTimeout&#x27;</span>)</span><br><span class="line">&#125;, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="title function_">setImmediate</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;setImmediate&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<ul>
<li>setTimeout&#x2F;setInterval çš„ç¬¬äºŒä¸ªå‚æ•°å–å€¼èŒƒå›´æ˜¯ï¼š[1, 2^31 - 1]ï¼Œå¦‚æœ<strong>è¶…è¿‡è¿™ä¸ªèŒƒå›´</strong>åˆ™ä¼š<strong>åˆå§‹åŒ–ä¸º 1</strong>ï¼Œå³ setTimeout(fn, 0) &#x3D;&#x3D;&#x3D; setTimeout(fn, 1)ã€‚</li>
<li>setTimeout çš„å›è°ƒå‡½æ•°åœ¨ timer é˜¶æ®µæ‰§è¡Œï¼ŒsetImmediate çš„å›è°ƒå‡½æ•°åœ¨ check é˜¶æ®µæ‰§è¡Œï¼Œevent loop çš„å¼€å§‹ä¼šå…ˆæ£€æŸ¥ timer é˜¶æ®µï¼Œä½†æ˜¯åœ¨å¼€å§‹ä¹‹å‰åˆ° timer é˜¶æ®µä¼šæ¶ˆè€—ä¸€å®šæ—¶é—´ï¼Œæ‰€ä»¥å°±ä¼šå‡ºç°ä¸¤ç§æƒ…å†µï¼š<ul>
<li>timer å‰çš„å‡†å¤‡æ—¶é—´è¶…è¿‡ 1msï¼Œæ»¡è¶³ loop-&gt;time &gt;&#x3D; 1ï¼Œåˆ™æ‰§è¡Œ timer é˜¶æ®µï¼ˆsetTimeoutï¼‰çš„å›è°ƒå‡½æ•°</li>
<li>timer å‰çš„å‡†å¤‡æ—¶é—´å°äº 1msï¼Œåˆ™å…ˆæ‰§è¡Œ check é˜¶æ®µï¼ˆsetImmediateï¼‰çš„å›è°ƒå‡½æ•°ï¼Œä¸‹ä¸€æ¬¡ event loop æ‰§è¡Œ timer é˜¶æ®µï¼ˆsetTimeoutï¼‰çš„å›è°ƒå‡½æ•°</li>
</ul>
</li>
</ul>
<p>åœ¨ä¸¾ä¾‹ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;setTimeout&#x27;</span>)</span><br><span class="line">&#125;, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="title function_">setImmediate</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;setImmediate&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> start = <span class="title class_">Date</span>.<span class="title function_">now</span>()</span><br><span class="line"><span class="keyword">while</span> (<span class="title class_">Date</span>.<span class="title function_">now</span>() - start &lt; <span class="number">10</span>);<span class="comment">//å‡†å¤‡æ—¶é—´è¶…è¿‡1msï¼Œåˆ™ç›´æ¥æ‰§è¡Œtimer</span></span><br></pre></td></tr></table></figure>

<h3 id="2-setTimeout-vs-setImmediate-2"><a href="#2-setTimeout-vs-setImmediate-2" class="headerlink" title="2.setTimeout vs setImmediate 2"></a>2.setTimeout vs setImmediate 2</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>)</span><br><span class="line"></span><br><span class="line">fs.<span class="title function_">readFile</span>(__filename, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;setTimeout&#x27;</span>)</span><br><span class="line">  &#125;, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">  <span class="title function_">setImmediate</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;setImmediate&#x27;</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">//setImmediate</span></span><br><span class="line"><span class="comment">//setTimeout</span></span><br></pre></td></tr></table></figure>

<p>åœ¨å¼•ç”¨ä¸€ä¸‹å®˜æ–¹å¯¹äºcheck phaseçš„ä»‹ç»</p>
<blockquote>
<p>This phase allows a person to execute callbacks immediately after the <strong>poll</strong> phase has completed. If the <strong>poll</strong> phase becomes idle and scripts have been queued with <code>setImmediate()</code>, the event loop may continue to the <strong>check</strong> phase rather than waiting.</p>
<p><code>setImmediate()</code> is actually a special timer that runs in a separate phase of the event loop. It uses a libuv API that schedules callbacks to execute after the <strong>poll</strong> phase has completed.</p>
<p>Generally, as the code is executed, the event loop will eventually hit the <strong>poll</strong> phase where it will wait for an incoming connection, request, etc. However, if a callback has been scheduled with <code>setImmediate()</code> and the <strong>poll</strong> phase becomes idle, it will end and continue to the <strong>check</strong> phase rather than waiting for <strong>poll</strong> events.</p>
</blockquote>
<p>fs.readFile çš„å›è°ƒå‡½æ•°æ‰§è¡Œå®Œåï¼š</p>
<ol>
<li>æ³¨å†Œ setTimeout çš„å›è°ƒå‡½æ•°åˆ° timer é˜¶æ®µ</li>
<li>æ³¨å†Œ setImmediate çš„å›è°ƒå‡½æ•°åˆ° check é˜¶æ®µ</li>
<li>event loop ä» pool é˜¶æ®µå‡ºæ¥ç»§ç»­å¾€ä¸‹ä¸€ä¸ªé˜¶æ®µæ‰§è¡Œï¼Œæ°å¥½æ˜¯ check é˜¶æ®µï¼Œæ‰€ä»¥ setImmediate çš„å›è°ƒå‡½æ•°å…ˆæ‰§è¡Œ</li>
<li>æœ¬æ¬¡ event loop ç»“æŸåï¼Œè¿›å…¥<strong>ä¸‹ä¸€æ¬¡ event loop</strong>ï¼Œæ‰§è¡Œ setTimeout çš„å›è°ƒå‡½æ•°</li>
</ol>
<p>æ‰€ä»¥ï¼Œåœ¨ I&#x2F;O Callbacks ä¸­æ³¨å†Œçš„ setTimeout å’Œ setImmediateï¼Œæ°¸è¿œéƒ½æ˜¯ setImmediate å…ˆæ‰§è¡Œã€‚</p>
<h3 id="3-process-nextTick"><a href="#3-process-nextTick" class="headerlink" title="3.process.nextTick()"></a>3.process.nextTick()</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;setInterval&#x27;</span>)</span><br><span class="line">&#125;, <span class="number">100</span>)</span><br><span class="line"></span><br><span class="line">process.<span class="title function_">nextTick</span>(<span class="keyword">function</span> <span class="title function_">tick</span> () &#123;</span><br><span class="line">  process.<span class="title function_">nextTick</span>(tick)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">//note</span></span><br><span class="line"><span class="title function_">setImmediate</span>(<span class="keyword">function</span> <span class="title function_">immediate</span> () &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;111&#x27;</span>);<span class="comment">//ä¼šç›´æ¥æ‰“å°å‡ºå¾ˆå¤šæ¬¡111</span></span><br><span class="line">  <span class="title function_">setImmediate</span>(immediate)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œç»“æœï¼šsetInterval <strong>æ°¸è¿œä¸ä¼šæ‰“å°å‡ºæ¥</strong>ã€‚</p>
<p>&#x2F;&#x2F;è¿™ä¸ªåœ¨node<a target="_blank" rel="noopener" href="https://nodejs.org/en/docs/guides/event-loop-timers-and-nexttick/#process-nexttick">å®˜æ–¹æ–‡æ¡£</a>ä¹Ÿæœ‰ç›¸å…³çš„æè¿°</p>
<p>&#x2F;&#x2F;æˆ‘åœ¨è¿™é‡Œä¹Ÿè¿›è¡Œäº†<a href="**https://zehai.info/2020/04/10/2020-04-10-eventloop/**">ç¬”è®°</a>è®°å½•</p>
<p>&#x2F;&#x2F;<em>å…è®¸ç”¨æˆ·å¤„ç†errorsï¼Œæ¸…ç†ä¸éœ€è¦çš„èµ„æºï¼Œäº‹ä»¶å¾ªç¯å‰ å°è¯•é‡æ–°è¿æ¥</em></p>
<p>&#x2F;&#x2F;<em>æœ‰æ—¶æœ‰å¿…è¦åœ¨eventloopç»§ç»­ä¹‹å‰ï¼Œåœ¨call stack unwoundä¹‹åï¼Œè®©callbackæ‰§è¡Œ</em></p>
<p><strong>è§£é‡Š</strong>ï¼šprocess.nextTick ä¼šæ— é™å¾ªç¯ï¼Œå°† event loop é˜»å¡åœ¨ microtask é˜¶æ®µï¼Œå¯¼è‡´ event loop ä¸Šå…¶ä»– macrotask é˜¶æ®µçš„å›è°ƒå‡½æ•°æ²¡æœ‰æœºä¼šæ‰§è¡Œã€‚&#x2F;&#x2F;<code>è¿™æ®µè§£é‡Šæ˜¯å‰ç«¯çš„ï¼Œåç«¯æ˜¯æ²¡æœ‰microtaskçš„å®é™…é˜Ÿåˆ—çš„</code></p>
<p>è§£å†³æ–¹æ³•é€šå¸¸æ˜¯ç”¨ setImmediate æ›¿ä»£ process.nextTickï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;setInterval&#x27;</span>)</span><br><span class="line">&#125;, <span class="number">100</span>)</span><br><span class="line"></span><br><span class="line"><span class="title function_">setImmediate</span>(<span class="keyword">function</span> <span class="title function_">immediate</span> () &#123;</span><br><span class="line">  <span class="title function_">setImmediate</span>(immediate)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œç»“æœï¼šæ¯ 100ms æ‰“å°ä¸€æ¬¡ setIntervalã€‚</p>
<p><strong>è§£é‡Š</strong>ï¼šprocess.nextTick å†…æ‰§è¡Œ process.nextTick ä»ç„¶å°† tick å‡½æ•°æ³¨å†Œåˆ°å½“å‰ microtask çš„å°¾éƒ¨ï¼Œæ‰€ä»¥å¯¼è‡´ microtask æ°¸è¿œæ‰§è¡Œä¸å®Œï¼› setImmediate å†…æ‰§è¡Œ setImmediate ä¼šå°† immediate å‡½æ•°æ³¨å†Œåˆ°ä¸‹ä¸€æ¬¡ event loop çš„ check é˜¶æ®µï¼Œè€Œä¸æ˜¯å½“å‰æ­£åœ¨æ‰§è¡Œçš„ check é˜¶æ®µï¼Œæ‰€ä»¥ç»™äº† event loop ä¸Šå…¶ä»– macrotask æ‰§è¡Œçš„æœºä¼šã€‚</p>
<p>å†çœ‹ä¸ªä¾‹å­ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">setImmediate</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;setImmediate1&#x27;</span>)</span><br><span class="line">  <span class="title function_">setImmediate</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;setImmediate2&#x27;</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">  process.<span class="title function_">nextTick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;nextTick&#x27;</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="title function_">setImmediate</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;setImmediate3&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œç»“æœï¼š</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">setImmediate1</span><br><span class="line">setImmediate3</span><br><span class="line">nextTick</span><br><span class="line">setImmediate2</span><br></pre></td></tr></table></figure>

<p><strong>æ³¨æ„</strong>ï¼šå¹¶<strong>ä¸æ˜¯è¯´ setImmediate å¯ä»¥å®Œå…¨æ›¿ä»£ process.nextTick</strong>ï¼Œprocess.nextTick åœ¨ç‰¹å®šåœºæ™¯ä¸‹è¿˜æ˜¯æ— æ³•è¢«æ›¿ä»£çš„ï¼Œæ¯”å¦‚æˆ‘ä»¬å°±æƒ³å°†ä¸€äº›æ“ä½œæ”¾åˆ°æœ€è¿‘çš„ microtask é‡Œæ‰§è¡Œã€‚</p>
<h3 id="4-promise"><a href="#4-promise" class="headerlink" title="4.promise"></a>4.promise</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> promise = <span class="title class_">Promise</span>.<span class="title function_">resolve</span>()</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> promise</span><br><span class="line">  &#125;)</span><br><span class="line">promise.<span class="title function_">catch</span>(<span class="variable language_">console</span>.<span class="property">error</span>)</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œç»“æœï¼š</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">TypeError: Chaining cycle detected for promise #&lt;Promise&gt;</span><br><span class="line">    at &lt;anonymous&gt;</span><br><span class="line">    at process._tickCallback (internal/process/next_tick.js:188:7)</span><br><span class="line">    at Function.Module.runMain (module.js:667:11)</span><br><span class="line">    at startup (bootstrap_node.js:187:16)</span><br><span class="line">    at bootstrap_node.js:607:3</span><br></pre></td></tr></table></figure>

<p><strong>è§£é‡Š</strong>ï¼špromise.then ç±»ä¼¼äº process.nextTickï¼Œéƒ½ä¼šå°†å›è°ƒå‡½æ•°æ³¨å†Œåˆ° microtask é˜¶æ®µã€‚ä¸Šé¢ä»£ç ä¼šå¯¼è‡´æ­»å¾ªç¯ï¼Œç±»ä¼¼å‰é¢æåˆ°çš„ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">process.<span class="title function_">nextTick</span>(<span class="keyword">function</span> <span class="title function_">tick</span> () &#123;</span><br><span class="line">  process.<span class="title function_">nextTick</span>(tick)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>å†çœ‹ä¸ªä¾‹å­ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> promise = <span class="title class_">Promise</span>.<span class="title function_">resolve</span>()</span><br><span class="line"></span><br><span class="line">promise.<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;promise&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">process.<span class="title function_">nextTick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;nextTick&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œç»“æœï¼š</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nextTick</span><br><span class="line">promise</span><br></pre></td></tr></table></figure>

<p><strong>è§£é‡Š</strong>ï¼špromise.then è™½ç„¶å’Œ process.nextTick ä¸€æ ·ï¼Œéƒ½å°†å›è°ƒå‡½æ•°æ³¨å†Œåˆ° microtaskï¼Œä½†ä¼˜å…ˆçº§ä¸ä¸€æ ·ã€‚process.nextTick çš„ microtask queue æ€»æ˜¯ä¼˜å…ˆäº promise çš„ microtask queue æ‰§è¡Œã€‚</p>
<h3 id="5-promiseæ‰§è¡Œé¡ºåº"><a href="#5-promiseæ‰§è¡Œé¡ºåº" class="headerlink" title="5.promiseæ‰§è¡Œé¡ºåº"></a>5.promiseæ‰§è¡Œé¡ºåº</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">1</span>)</span><br><span class="line">&#125;, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">2</span>)</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">10000</span>; i++) &#123;</span><br><span class="line">    i === <span class="number">9999</span> &amp;&amp; <span class="title function_">resolve</span>()</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">3</span>)</span><br><span class="line">&#125;).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">4</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">5</span>)</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œç»“æœï¼š</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">2</span><br><span class="line">3</span><br><span class="line">5</span><br><span class="line">4</span><br><span class="line">1</span><br></pre></td></tr></table></figure>

<p><strong>è§£é‡Š</strong>ï¼šPromise æ„é€ å‡½æ•°æ˜¯åŒæ­¥æ‰§è¡Œçš„ï¼Œæ‰€ä»¥å…ˆæ‰“å° 2ã€3ï¼Œç„¶åæ‰“å° 5ï¼Œæ¥ä¸‹æ¥ event loop è¿›å…¥æ‰§è¡Œ microtask é˜¶æ®µï¼Œæ‰§è¡Œ promise.then çš„å›è°ƒå‡½æ•°æ‰“å°å‡º 4ï¼Œç„¶åæ‰§è¡Œä¸‹ä¸€ä¸ª macrotaskï¼Œæ°å¥½æ˜¯ timer é˜¶æ®µçš„ setTimeout çš„å›è°ƒå‡½æ•°ï¼Œæ‰“å°å‡º 1ã€‚</p>
<h3 id="6-ç»¼åˆ"><a href="#6-ç»¼åˆ" class="headerlink" title="6.ç»¼åˆ"></a>6.ç»¼åˆ</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">setImmediate</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">1</span>)</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">2</span>)</span><br><span class="line">  &#125;, <span class="number">100</span>)</span><br><span class="line">  <span class="title function_">setImmediate</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">3</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">  process.<span class="title function_">nextTick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">4</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line">process.<span class="title function_">nextTick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">5</span>)</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">6</span>)</span><br><span class="line">  &#125;, <span class="number">100</span>)</span><br><span class="line">  <span class="title function_">setImmediate</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">7</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">  process.<span class="title function_">nextTick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">8</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">9</span>)</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œç»“æœï¼š</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">9</span><br><span class="line">5</span><br><span class="line">8</span><br><span class="line">1</span><br><span class="line">7</span><br><span class="line">4</span><br><span class="line">3</span><br><span class="line">6</span><br><span class="line">2</span><br></pre></td></tr></table></figure>

<p>process.nextTickã€setTimeout å’Œ setImmediate çš„ç»„åˆï¼Œè¯·è¯»è€…è‡ªå·±æ¨ç†å§ã€‚</p>
<h1 id="other-source-code"><a href="#other-source-code" class="headerlink" title="other source code"></a>other source code</h1><h2 id="setTimeout"><a href="#setTimeout" class="headerlink" title="setTimeout()"></a>setTimeout()</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//lib/timers/promises.js</span></span><br><span class="line"><span class="comment">//setTimeout(function()&#123;&#125;,expire)</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">setTimeout</span>(<span class="params">after, value, options = &#123;&#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> args = value !== <span class="literal">undefined</span> ? [value] : value;</span><br><span class="line">  <span class="keyword">if</span> (options == <span class="literal">null</span> || <span class="keyword">typeof</span> options !== <span class="string">&#x27;object&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">PromiseReject</span>(</span><br><span class="line">      <span class="keyword">new</span> <span class="title function_">ERR_INVALID_ARG_TYPE</span>(</span><br><span class="line">        <span class="string">&#x27;options&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;Object&#x27;</span>,</span><br><span class="line">        options));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> &#123; signal, ref = <span class="literal">true</span> &#125; = options;</span><br><span class="line">  <span class="keyword">if</span> (signal !== <span class="literal">undefined</span> &amp;&amp;</span><br><span class="line">      (signal === <span class="literal">null</span> ||</span><br><span class="line">       <span class="keyword">typeof</span> signal !== <span class="string">&#x27;object&#x27;</span> ||</span><br><span class="line">       !(<span class="string">&#x27;aborted&#x27;</span> <span class="keyword">in</span> signal))) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">PromiseReject</span>(</span><br><span class="line">      <span class="keyword">new</span> <span class="title function_">ERR_INVALID_ARG_TYPE</span>(</span><br><span class="line">        <span class="string">&#x27;options.signal&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;AbortSignal&#x27;</span>,</span><br><span class="line">        signal));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> ref !== <span class="string">&#x27;boolean&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">PromiseReject</span>(</span><br><span class="line">      <span class="keyword">new</span> <span class="title function_">ERR_INVALID_ARG_TYPE</span>(</span><br><span class="line">        <span class="string">&#x27;options.ref&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;boolean&#x27;</span>,</span><br><span class="line">        ref));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// TODO(@jasnell): If a decision is made that this cannot be backported</span></span><br><span class="line">  <span class="comment">// to 12.x, then this can be converted to use optional chaining to</span></span><br><span class="line">  <span class="comment">// simplify the check.</span></span><br><span class="line">  <span class="keyword">if</span> (signal &amp;&amp; signal.<span class="property">aborted</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">PromiseReject</span>(<span class="title function_">lazyDOMException</span>(<span class="string">&#x27;AbortError&#x27;</span>));</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> timeout = <span class="keyword">new</span> <span class="title class_">Timeout</span>(resolve, after, args, <span class="literal">false</span>, <span class="literal">true</span>);</span><br><span class="line">    <span class="keyword">if</span> (!ref) timeout.<span class="title function_">unref</span>();</span><br><span class="line">    <span class="title function_">insert</span>(timeout, timeout.<span class="property">_idleTimeout</span>);</span><br><span class="line">    <span class="keyword">if</span> (signal) &#123;</span><br><span class="line">      signal.<span class="title function_">addEventListener</span>(<span class="string">&#x27;abort&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!timeout.<span class="property">_destroyed</span>) &#123;</span><br><span class="line">          <span class="comment">// eslint-disable-next-line no-undef</span></span><br><span class="line">          <span class="built_in">clearTimeout</span>(timeout);</span><br><span class="line">          <span class="title function_">reject</span>(<span class="title function_">lazyDOMException</span>(<span class="string">&#x27;AbortError&#x27;</span>));</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;, &#123; <span class="attr">once</span>: <span class="literal">true</span> &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/06/08/2020-06-08-%E7%AE%97%E6%B3%95%E5%9B%BE%E8%A7%A3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zehai's Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Zehai's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/06/08/2020-06-08-%E7%AE%97%E6%B3%95%E5%9B%BE%E8%A7%A3/" class="post-title-link" itemprop="url">ç®—æ³•å›¾è§£</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2020-06-08 11:34:04" itemprop="dateCreated datePublished" datetime="2020-06-08T11:34:04+08:00">2020-06-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-04-07 22:34:12" itemprop="dateModified" datetime="2024-04-07T22:34:12+08:00">2024-04-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Books/" itemprop="url" rel="index"><span itemprop="name">Books</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="1-ç®—æ³•ç®€ä»‹"><a href="#1-ç®—æ³•ç®€ä»‹" class="headerlink" title="1. ç®—æ³•ç®€ä»‹"></a>1. ç®—æ³•ç®€ä»‹</h1><h2 id="1-1-äºŒåˆ†"><a href="#1-1-äºŒåˆ†" class="headerlink" title="1.1 äºŒåˆ†"></a>1.1 äºŒåˆ†</h2><p>Why: å¤æ‚åº¦O(n)â€”&gt;O(logn)</p>
<p>ä½¿ç”¨é™åˆ¶ï¼šæœ‰åºæ•°ç»„</p>
<h2 id="1-2-å¤§Oè¡¨ç¤º"><a href="#1-2-å¤§Oè¡¨ç¤º" class="headerlink" title="1.2 å¤§Oè¡¨ç¤º"></a>1.2 å¤§Oè¡¨ç¤º</h2><p>æŒ‡å‡ºç®—æ³•è¿è¡Œæ—¶é—´çš„å¢é€Ÿï¼Œç®—æ³•éœ€è¦åšçš„å°±æ˜¯æŠŠO(n^2)ä¼˜åŒ–åˆ°O(n)ç­‰</p>
<h1 id="2-é€‰æ‹©æ’åº"><a href="#2-é€‰æ‹©æ’åº" class="headerlink" title="2. é€‰æ‹©æ’åº"></a>2. é€‰æ‹©æ’åº</h1><h2 id="2-1-æ•°ç»„-é“¾è¡¨"><a href="#2-1-æ•°ç»„-é“¾è¡¨" class="headerlink" title="2.1 æ•°ç»„ é“¾è¡¨"></a>2.1 æ•°ç»„ é“¾è¡¨</h2><p>æ•°ç»„ï¼šè¿ç»­ç‰©ç†ç©ºé—´ï¼Œå¯éšæœºè®¿é—®ï¼Œå¢åˆ æ•°æ®å¤æ‚åº¦é«˜</p>
<p>é“¾è¡¨ï¼šåˆ†æ•£æ— åŠ›ç©ºé—´ï¼Œä¸å¯éšæœºè®¿é—®ï¼ˆåªèƒ½é¡ºåºï¼‰ï¼Œå¢åˆ æ•°æ®å¤æ‚åº¦ä½</p>
<table>
<thead>
<tr>
<th></th>
<th>æ•°ç»„</th>
<th>é“¾è¡¨</th>
</tr>
</thead>
<tbody><tr>
<td>è¯»æ”¹</td>
<td>O(1)</td>
<td>O(n)</td>
</tr>
<tr>
<td>å¢åˆ </td>
<td>O(n)</td>
<td>O(1)</td>
</tr>
</tbody></table>
<p>æ ¹æ®äº’ç›¸ç‰¹æ€§ï¼Œé€‰æ‹©åˆé€‚çš„æ–¹å¼ï¼Œå¦‚é¢‘ç¹å¢åˆ ç”¨é“¾è¡¨ï¼Œåä¹‹ç”¨æ•°ç»„</p>
<h2 id="2-2-é€‰æ‹©æ’åº"><a href="#2-2-é€‰æ‹©æ’åº" class="headerlink" title="2.2 é€‰æ‹©æ’åº"></a>2.2 é€‰æ‹©æ’åº</h2><p>å¤æ‚åº¦ï¼šO(n^2)</p>
<p>éå†n ä¸ªå…ƒç´ <strong>é€‰æ‹©</strong> æœ€å°&#x2F;å¤§çš„ï¼Œéå†n-1ä¸ªå…ƒç´ <strong>é€‰æ‹©</strong> æœ€å°&#x2F;å¤§çš„</p>
<h1 id="3-é€’å½’"><a href="#3-é€’å½’" class="headerlink" title="3. é€’å½’"></a>3. é€’å½’</h1><p>ç±»æ¯”ï¼šå¥—å¨ƒ :call_me_hand:</p>
<p>æ€§èƒ½å’Œæ˜“è¯»ä¸å¯å…¼å¾—</p>
<p>é¿å…<strong>æ­»å¾ªç¯</strong>ï¼</p>
<p><strong>å°¾é€’å½’</strong>å¯ä»¥è§£å†³éƒ¨åˆ†æ€§èƒ½é—®é¢˜</p>
<p>é€’å½’è°ƒç”¨æ ˆæ˜¯æ€§èƒ½é™ä½çš„åŸå› ï¼Œéµå¾ªFIFO</p>
<h1 id="4-å¿«æ’"><a href="#4-å¿«æ’" class="headerlink" title="4. å¿«æ’"></a>4. å¿«æ’</h1><p>æ ¸å¿ƒï¼šåˆ†è€Œæ²»ä¹‹divide and conquerï¼Œå¿«æ’åªæ˜¯å…¶ä¸­çš„ä¸€ä¸ªåº”ç”¨</p>
<p>æ€æƒ³ï¼šé€’å½’çš„ä¸€ç§åº”ç”¨</p>
<p>å¿«æ’ï¼ˆé€’å½’ï¼‰æ˜¯ä¸€ç§<strong>å‡½æ•°å¼ç¼–ç¨‹</strong></p>
<p>å¿«æ’é€šè¿‡åŸºå‡†å€¼ï¼ˆå¯ä»¥é€‰ç¬¬ä¸€ä¸ªå…ƒç´ ï¼‰è¿›è¡Œåˆ†è€Œæ²»ä¹‹</p>
<h1 id="5-æ•£åˆ—è¡¨"><a href="#5-æ•£åˆ—è¡¨" class="headerlink" title="5. æ•£åˆ—è¡¨"></a>5. æ•£åˆ—è¡¨</h1><p>å®ç°æ–¹å¼ï¼š<strong>æ•°ç»„</strong>ï¼Œéé“¾è¡¨ï¼Œæ£€ç´¢å€¼keyç±»ä¼¼æ•°ç»„çš„ä¸‹è¡¨ï¼Œå¯ç›´æ¥è®¿é—®value</p>
<p>åº”ç”¨ï¼šDNSï¼Œé˜»æ­¢é‡å¤æ•°æ®(ç±»seté›†)ï¼Œä½œç¼“å­˜ï¼ˆæœåŠ¡å™¨ç«¯ï¼‰</p>
<table>
<thead>
<tr>
<th>å¤æ‚åº¦</th>
<th>æ•£åˆ—å¹³å‡</th>
<th>æ•£åˆ—æœ€ç³Ÿ</th>
<th>æ•°ç»„</th>
<th>é“¾è¡¨</th>
</tr>
</thead>
<tbody><tr>
<td>æŸ¥æ‰¾</td>
<td>1</td>
<td>n</td>
<td>1</td>
<td>n</td>
</tr>
<tr>
<td>æ’å…¥åˆ é™¤</td>
<td>1</td>
<td>n</td>
<td>n</td>
<td>1</td>
</tr>
</tbody></table>
<p>è£…å¡«å› å­ï¼ˆ0.4ï¼‰&#x3D;æ•£åˆ—å…ƒç´ ï¼ˆ4ï¼‰&#x2F;ä½ç½®æ€»æ•°ï¼ˆ10ï¼‰</p>
<p>é¿å…å†²çªï¼š1.è‰¯å¥½çš„æ•£åˆ—å‡½æ•°ï¼ˆå‡åŒ€åˆ†å¸ƒï¼‰ 2.è¾ƒä½çš„è£…å¡«å› å­ï¼ˆ&lt;<strong>0.7</strong>ï¼‰</p>
<p>å°†æ»¡æ—¶å€™ï¼š1.ç”³è¯·ä¸¤å€äºåŸæ¥çš„ æ–°ç©ºé—´ 2.hashæ‰€æœ‰å…ƒç´ åˆ°æ–°ç©ºé—´</p>
<p>å†²çªè§£å†³ï¼š</p>
<ul>
<li>å¼€æ”¾åœ°å€ï¼ˆæœ€ç®€å•å°±æ˜¯å†²çªé¡ºå»¶ä¸‹ä¸€ä½ï¼Œç›´åˆ°ä¸ºç©ºï¼‰</li>
<li>æ‹‰é“¾å‘ï¼ˆæŒ‡åœ¨æŸä¸ªä½å­ä¸Šå†æ‹‰ä¸€æ¡é“¾è¡¨ï¼ŒéğŸ‘–æ‹‰é“¾ï¼‰</li>
</ul>
<h1 id="6-BFS"><a href="#6-BFS" class="headerlink" title="6.BFS"></a>6.BFS</h1><p>å¹¿åº¦ä¼˜å…ˆæœç´¢breadth first searchï¼Œè§£å†³<strong>æ— åŠ æƒ</strong>æœ€çŸ­è·¯å¾„é—®é¢˜ä¹‹ä¸€</p>
<p>åº”ç”¨ï¼šå›½é™…è·³æ£‹ï¼Œæ‹¼å†™æ£€æŸ¥ï¼Œäººé™…å…³ç³»ç½‘ç»œ</p>
<h1 id="7-Dijkstra"><a href="#7-Dijkstra" class="headerlink" title="7. Dijkstra"></a>7. Dijkstra</h1><p><strong>æ­£åŠ æƒæœ‰å‘æ— ç¯</strong>å›¾çš„è§£å†³ç®—æ³•</p>
<ol>
<li>æœ€çŸ­æ—¶é—´å†…åˆ°è¾¾çš„èŠ‚ç‚¹</li>
<li>æ›´æ–°è¯¥èŠ‚ç‚¹ä¸´æ¥èŠ‚ç‚¹çš„å¼€é”€</li>
<li>é‡å¤</li>
<li>è®¡ç®—æœ€ç»ˆè·¯å¾„</li>
</ol>
<p>è§£å†³ç¯ï¼š</p>
<p>è´ŸåŠ æƒï¼šbellman ford algorithm</p>
<h1 id="8-Greedy"><a href="#8-Greedy" class="headerlink" title="8. Greedy"></a>8. Greedy</h1><p>æ¯æ­¥æœ€ä¼˜â€“&gt;å…¨å±€æœ€ä¼˜ï¼Œå¾—åˆ°è¿‘ä¼¼æ­£ç¡®çš„ç»“æœ</p>
<h1 id="9-DP"><a href="#9-DP" class="headerlink" title="9.DP"></a>9.DP</h1><p>åˆ—å‡ºæ‰€æœ‰å¯èƒ½</p>
<h1 id="10-Kæœ€é‚»è¿‘ç®—æ³•"><a href="#10-Kæœ€é‚»è¿‘ç®—æ³•" class="headerlink" title="10. Kæœ€é‚»è¿‘ç®—æ³•"></a>10. Kæœ€é‚»è¿‘ç®—æ³•</h1><h1 id="11-next"><a href="#11-next" class="headerlink" title="11.next"></a>11.next</h1><p>æ ‘è§£å†³äº†äºŒåˆ†æŸ¥æ‰¾ä¸­ï¼Œæ’å…¥åˆ é™¤O(n)é™ä½åˆ°O(log n)ï¼Œä½†æ˜¯é™ä½äº†éšæœºè®¿é—®èƒ½åŠ›</p>
<p>æ ‘åŒ…æ‹¬ï¼šäºŒå‰æ ‘ï¼Œå¹³è¡¡äºŒå‰æ ‘ï¼ŒBæ ‘ B+æ ‘ï¼Œï¼Œçº¢é»‘æ ‘</p>
<p>åå‘ç´¢å¼•ï¼šæ•£åˆ—è¡¨ï¼Œç”¨äºåˆ›å»ºæœç´¢å¼•æ“â€”&gt;åº”ç”¨ï¼šå‚…é‡Œå¶å˜æ¢</p>
<p>å¹¶è¡Œç®—æ³•ï¼Œå•æœºå¹¶è¡Œoråˆ†å¸ƒå¼ï¼Œåº”ç”¨ï¼šmapreduceï¼Œmap-&gt;æ˜ å°„ ï¼Œreduce-&gt;å½’å¹¶</p>
<p>å¸ƒéš†è¿‡æ»¤å™¨ï¼šåºå¤§çš„æ•£åˆ—è¡¨ï¼ˆå¦‚è°·æ­Œçš„ä¸Šäº¿æ¡ï¼‰ï¼Œé€šå¸¸ä½¿ç”¨rediså®ç°ï¼Œæ˜¯ä¸€ç§æ¦‚ç‡å‹æ•°æ®ç»“æ„ï¼ˆ<strong>å¶å°”å‡ºé”™</strong>ï¼‰ï¼Œä½¿ç”¨ç†ç”±ï¼Œå­˜å‚¨ç©ºé—´å°‘</p>
<p>hyperLogLogï¼šç±»ä¼¼å¸ƒéš†ï¼Œæ˜¯ä¸ªæ—¥å¿—</p>
<p>SHAç®—æ³•</p>
<ul>
<li>æ•£åˆ—çš„ä¸€ç§åº”ç”¨</li>
<li>åˆ¤æ–­ä¸¤ä¸ªï¼ˆè¶…å¤§ï¼‰æ–‡ä»¶æ˜¯å¦ç›¸åŒï¼ˆæ•£åˆ—å€¼ç›¸åŒï¼‰</li>
<li>SHAï¼ˆç”¨æˆ·è¾“å…¥å¯†ç ï¼‰ï¼Ÿ&#x3D;&#x3D; æ•°æ®åº“å­˜å‚¨çš„SHAå€¼ï¼Œä¸”æ‹–åº“åæ— æ³•è¿˜åŸå¯†ç </li>
<li>SHAæ˜¯ä¸€ç³»åˆ—ç®—æ³•çš„ç»Ÿç§°ï¼ŒåŒ…æ‹¬SHA-0 ,SHA-1 SHA-2 SHA-3 bcrypt etc</li>
<li>SHAå…¨å±€æ•æ„Ÿï¼ˆæ”¹åŠ¨å±€éƒ¨ï¼Œæ•´ä½“å…¨å˜ï¼‰ï¼ŒSIMhashå±€éƒ¨æ•æ„Ÿï¼ˆå±€éƒ¨æ”¹å˜ï¼Œæ•£åˆ—å€¼å±€éƒ¨æ”¹å˜ï¼‰ï¼Œåè€…ç”¨äºåˆ¤æ–­ç½‘é¡µæ˜¯å¦å·²ç»æœé›†ï¼Œä½œä¸šæ˜¯å¦æŠ„è¢­ï¼Œç›¸ä¼¼åº¦æŸ¥è¯¢</li>
<li>diffie-hellmanå¯†é’¥äº¤æ¢<ul>
<li>åŒæ–¹æ— éœ€çŸ¥é“åŠ å¯†ç®—æ³•ï¼Œç ´è§£éš¾åº¦å¤§</li>
<li>å…¬é’¥ä¸ç§é’¥ï¼Œclientè·å–å…¬é’¥åï¼Œ1.ä½¿ç”¨å…¬é’¥åŠ å¯† 2.æœåŠ¡å™¨ç«¯ä½¿ç”¨ç§é’¥è§£å¯†</li>
</ul>
</li>
</ul>
<p>çº¿æ€§è§„åˆ’ï¼šsimplexç®—æ³•</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/05/30/2020-05-25-FirstUniqueCharacterInAString/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zehai's Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Zehai's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/05/30/2020-05-25-FirstUniqueCharacterInAString/" class="post-title-link" itemprop="url">2020-05-25-FirstUniqueCharacterInAString</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2020-05-30 21:15:37" itemprop="dateCreated datePublished" datetime="2020-05-30T21:15:37+08:00">2020-05-30</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-04-07 22:34:12" itemprop="dateModified" datetime="2024-04-07T22:34:12+08:00">2024-04-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/LeetCode/" itemprop="url" rel="index"><span itemprop="name">LeetCode</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Leetcode-64"><a href="#Leetcode-64" class="headerlink" title="Leetcode-64"></a>Leetcode-64</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Given a string, find the first non-repeating character in it and return it&#x27;s index. If it doesn&#x27;t exist, return -1.</span><br><span class="line"></span><br><span class="line">Examples:</span><br><span class="line"></span><br><span class="line">s = &quot;leetcode&quot;</span><br><span class="line">return 0.</span><br><span class="line"></span><br><span class="line">s = &quot;loveleetcode&quot;,</span><br><span class="line">return 2.</span><br><span class="line">Note: You may assume the string contain only lowercase letters.</span><br></pre></td></tr></table></figure>

<h1 id="solution"><a href="#solution" class="headerlink" title="solution"></a>solution</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * @param &#123;string&#125; s</span><br><span class="line"> * @return &#123;number&#125;</span><br><span class="line"> */</span><br><span class="line">var firstUniqChar = function(s) &#123;</span><br><span class="line">    for(var i=0;i&lt;s.length;i++)&#123;</span><br><span class="line">        var flag = false;</span><br><span class="line">        for(var j=0;j&lt;s.length;j++)&#123;</span><br><span class="line">            if(i==j)continue;</span><br><span class="line">            if(s[i]==s[j])flag=true;</span><br><span class="line">        &#125;</span><br><span class="line">        if(!flag)return i;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    return -1;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">class Solution &#123;</span><br><span class="line">    public int firstUniqChar(String s) &#123;</span><br><span class="line">        HashMap&lt;Character, Integer&gt; count = new HashMap&lt;Character, Integer&gt;();</span><br><span class="line">        int n = s.length();</span><br><span class="line">        // build hash map : character and how often it appears</span><br><span class="line">        for (int i = 0; i &lt; n; i++) &#123;</span><br><span class="line">            char c = s.charAt(i);</span><br><span class="line">            count.put(c, count.getOrDefault(c, 0) + 1);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        // find the index</span><br><span class="line">        for (int i = 0; i &lt; n; i++) &#123;</span><br><span class="line">            if (count.get(s.charAt(i)) == 1) </span><br><span class="line">                return i;</span><br><span class="line">        &#125;</span><br><span class="line">        return -1;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/05/13/2020-05-13-%E7%9B%91%E6%8E%A7%E8%BD%AF%E4%BB%B6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zehai's Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Zehai's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/05/13/2020-05-13-%E7%9B%91%E6%8E%A7%E8%BD%AF%E4%BB%B6/" class="post-title-link" itemprop="url">monit</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2020-05-13 16:18:55" itemprop="dateCreated datePublished" datetime="2020-05-13T16:18:55+08:00">2020-05-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-04-07 22:34:12" itemprop="dateModified" datetime="2024-04-07T22:34:12+08:00">2024-04-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/monit/" itemprop="url" rel="index"><span itemprop="name">monit</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>ç›‘æ§</p>
<h1 id="åç«¯"><a href="#åç«¯" class="headerlink" title="åç«¯"></a>åç«¯</h1><p>prometheus vs zabbix</p>
<p>å…ˆå¯¹ä¸¤è€…çš„å„è‡ªç‰¹ç‚¹è¿›è¡Œä¸€ä¸‹å¯¹æ¯”ï¼š</p>
<table>
<thead>
<tr>
<th>Zabbix</th>
<th>Prometheus</th>
</tr>
</thead>
<tbody><tr>
<td>åç«¯ç”¨ C å¼€å‘ï¼Œç•Œé¢ç”¨ PHP å¼€å‘ï¼Œå®šåˆ¶åŒ–éš¾åº¦å¾ˆé«˜ã€‚</td>
<td>åç«¯ç”¨ golang å¼€å‘ï¼Œå‰ç«¯æ˜¯ Grafanaï¼ŒJSON ç¼–è¾‘å³å¯è§£å†³ã€‚å®šåˆ¶åŒ–éš¾åº¦è¾ƒä½ã€‚</td>
</tr>
<tr>
<td>é›†ç¾¤è§„æ¨¡ä¸Šé™ä¸º 10000 ä¸ªèŠ‚ç‚¹ã€‚</td>
<td>æ”¯æŒæ›´å¤§çš„é›†ç¾¤è§„æ¨¡ï¼Œé€Ÿåº¦ä¹Ÿæ›´å¿«ã€‚</td>
</tr>
<tr>
<td>æ›´é€‚åˆç›‘æ§ç‰©ç†æœºç¯å¢ƒã€‚</td>
<td>æ›´é€‚åˆäº‘ç¯å¢ƒçš„ç›‘æ§ï¼Œå¯¹ OpenStackï¼Œ<strong>Kubernetes</strong> æœ‰æ›´å¥½çš„é›†æˆã€‚</td>
</tr>
<tr>
<td>ç›‘æ§æ•°æ®å­˜å‚¨åœ¨å…³ç³»å‹æ•°æ®åº“å†…ï¼Œå¦‚ MySQLï¼Œå¾ˆéš¾ä»ç°æœ‰æ•°æ®ä¸­æ‰©å±•ç»´åº¦ã€‚</td>
<td>ç›‘æ§æ•°æ®å­˜å‚¨åœ¨åŸºäº**æ—¶é—´åºåˆ—(TSDB)**çš„æ•°æ®åº“å†…ï¼Œä¾¿äºå¯¹å·²æœ‰æ•°æ®è¿›è¡Œæ–°çš„èšåˆã€‚</td>
</tr>
<tr>
<td>å®‰è£…ç®€å•ï¼Œzabbix-server ä¸€ä¸ªè½¯ä»¶åŒ…ä¸­åŒ…æ‹¬äº†æ‰€æœ‰çš„æœåŠ¡ç«¯åŠŸèƒ½ã€‚</td>
<td>å®‰è£…ç›¸å¯¹å¤æ‚ï¼Œ<strong>ç›‘æ§ã€å‘Šè­¦å’Œç•Œé¢</strong>éƒ½åˆ†å±äºä¸åŒçš„ç»„ä»¶ã€‚</td>
</tr>
<tr>
<td><strong>å›¾å½¢åŒ–ç•Œé¢</strong>æ¯”è¾ƒæˆç†Ÿï¼Œç•Œé¢ä¸ŠåŸºæœ¬ä¸Šèƒ½å®Œæˆå…¨éƒ¨çš„é…ç½®æ“ä½œã€‚</td>
<td>ç•Œé¢ç›¸å¯¹è¾ƒå¼±ï¼Œå¾ˆå¤šé…ç½®éœ€è¦ä¿®æ”¹é…ç½®æ–‡ä»¶ã€‚</td>
</tr>
<tr>
<td>å‘å±•æ—¶é—´æ›´é•¿ï¼Œå¯¹äºå¾ˆå¤šç›‘æ§åœºæ™¯ï¼Œéƒ½æœ‰ç°æˆçš„è§£å†³æ–¹æ¡ˆã€‚</td>
<td>2015 å¹´åå¼€å§‹å¿«é€Ÿå‘å±•ï¼Œä½†å‘å±•æ—¶é—´è¾ƒçŸ­ï¼Œæˆç†Ÿåº¦ä¸åŠ Zabbixã€‚</td>
</tr>
</tbody></table>
<p>ç”±äºæœ€åæ•²å®šäº†Prometheusæ–¹æ¡ˆï¼Œå¯¹äºzabbixå°±äº‘è¯„æµ‹äº†ï¼Œæ¬¢è¿æŒ‡æ­£</p>
<ul>
<li>è™½ç„¶å›¾å½¢åŒ–ç•Œé¢å¼±åŒ–ï¼Œå¾ˆå¤šé…ç½®èµ°ymlæ–‡ä»¶ï¼Œä½†å›¾å½¢åŒ–ç•Œé¢çœŸçš„æ²¡æœ‰å¿…è¦</li>
<li>æ—¶åºæ•°æ®åº“ï¼Œé«˜å¹¶å‘ä¸‹å¥½äºmysqlï¼ˆä¸ç„¶å¹²å˜›å¼€å‘tsdbåº”å¯¹ç›‘æ§åœºæ™¯ï¼‰</li>
<li>promæ”¯æŒpullå’Œpushæ¨¡å‹ï¼Œå¯ä»¥æ”¯æŒk8sï¼Œswarmç­‰æœåŠ¡å‘ç°</li>
</ul>
<h1 id="å‰ç«¯"><a href="#å‰ç«¯" class="headerlink" title="å‰ç«¯"></a>å‰ç«¯</h1><p>Performanceï¼ŸwebVitalsï¼Ÿä»¥åç”¨åˆ°å†è¡¥å……</p>
<p>ä¸»è¦å…³æ³¨æ€§èƒ½ï¼Œpvï¼Œredirectï¼Œerrç­‰é—®é¢˜</p>
<h1 id="é¡µé¢æ˜¯å¦å¯ç”¨"><a href="#é¡µé¢æ˜¯å¦å¯ç”¨" class="headerlink" title="é¡µé¢æ˜¯å¦å¯ç”¨"></a>é¡µé¢æ˜¯å¦å¯ç”¨</h1><p>é˜¿é‡Œäº‘-äº‘ç›‘æ§æ§åˆ¶å°</p>
<p>å¯æä¾›ç½‘å€ç›‘æ§ï¼ŒåŒ…æ‹¬cookie, headers ç­‰è‡ªå®šä¹‰çš„ç®€å•é…ç½®ï¼Œè¿›è¡Œç”µè¯ï¼Œé‚®ä»¶ï¼ŒçŸ­ä¿¡ï¼Œæ—ºæ—ºç­‰æŠ¥è­¦</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/04/22/2020-04-22-Node14/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zehai's Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Zehai's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/04/22/2020-04-22-Node14/" class="post-title-link" itemprop="url">Node.JSv14</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2020-04-22 10:37:29" itemprop="dateCreated datePublished" datetime="2020-04-22T10:37:29+08:00">2020-04-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-04-07 22:34:12" itemprop="dateModified" datetime="2024-04-07T22:34:12+08:00">2024-04-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Node/" itemprop="url" rel="index"><span itemprop="name">Node</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="new"><a href="#new" class="headerlink" title="new"></a>new</h1><p>mod<br>ä»Šå¤©çœ‹åˆ°Node Currentæ›´æ–°äº†14çš„ç‰ˆæœ¬ï¼Œçœ‹çœ‹éƒ½æœ‰äº›ä»€ä¹ˆä¸œè¥¿</p>
<p>å‰ç½®äº†è§£äº†ä¸€ä¸‹docä¸­æåˆ°çš„semverï¼Œæ˜¯ä¸€ä¸ªè¯­ä¹‰åŒ–ç‰ˆæœ¬semantic versioningï¼Œå®ç°ç‰ˆæœ¬å’Œç‰ˆæœ¬è§„èŒƒçš„è§£æï¼Œè®¡ç®—ï¼Œæ¯”è¾ƒï¼Œç”¨ä»¥è§£å†³åœ¨å¤§å‹é¡¹ç›®ä¸­å¯¹ä¾èµ–çš„ç‰ˆæœ¬å¤±å»æ§åˆ¶çš„é—®é¢˜ï¼ŒNode.js çš„åŒ…ç®¡ç†å·¥å…· npm ä¹Ÿå®Œå…¨åŸºäº Semantic Versioning æ¥ç®¡ç†ä¾èµ–çš„ç‰ˆæœ¬ã€‚</p>
<p>å‚è€ƒèµ„æ–™ï¼š<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/20747196">semverï¼šè¯­ä¹‰åŒ–ç‰ˆæœ¬è§„èŒƒåœ¨ Node.js ä¸­çš„å®ç°</a></p>
<h2 id="deprecations"><a href="#deprecations" class="headerlink" title="deprecations"></a>deprecations</h2><p>sermverå¼ƒç”¨ä¸€éƒ¨åˆ†åŠŸèƒ½</p>
<ul>
<li><strong>(SEMVER-MAJOR)</strong> <strong>crypto</strong>: move pbkdf2 without digest to EOL (James M Snell) </li>
<li><strong>(SEMVER-MAJOR)</strong> <strong>fs</strong>: deprecate closing FileHandle on garbage collection (James M Snell)</li>
<li><strong>(SEMVER-MAJOR)</strong> <strong>http</strong>: move OutboundMessage.prototype.flush to EOL (James M Snell)</li>
<li><strong>(SEMVER-MAJOR)</strong> <strong>lib</strong>: move GLOBAL and root aliases to EOL (James M Snell)</li>
<li><strong>(SEMVER-MAJOR)</strong> <strong>os</strong>: move tmpDir() to EOL (James M Snell) </li>
<li><strong>(SEMVER-MAJOR)</strong> <strong>src</strong>: remove deprecated wasm type check (Clemens Backes) </li>
<li><strong>(SEMVER-MAJOR)</strong> <strong>stream</strong>: move _writableState.buffer to EOL (James M Snell)</li>
<li><strong>(SEMVER-MINOR)</strong> <strong>doc</strong>: deprecate process.mainModule (Antoine du HAMEL)</li>
<li><strong>(SEMVER-MINOR)</strong> <strong>doc</strong>: deprecate process.umask() with no arguments (Colin Ihrig)</li>
</ul>
<h2 id="ECMAScript-Modules"><a href="#ECMAScript-Modules" class="headerlink" title="ECMAScript Modules"></a>ECMAScript Modules</h2><p>åœ¨ <code>v13</code> ä¸­ï¼Œéœ€è¦è°ƒç”¨ <code>--experimental-modules</code> æ¥å¼€å¯ <code>ESM module</code> æ”¯æŒï¼Œ è€Œä¸”è¿˜ä¼šæœ‰è­¦å‘Šï¼Œä½†ç›®å‰å·²ç»ç§»é™¤è­¦å‘Šï¼ˆè¿˜æ˜¯éœ€è¦æ‰‹åŠ¨å¼€å¯ï¼‰<br>ä»åœ¨å®éªŒä¸­ï¼Œä½†æ˜¯å…¶å·²ç»éå¸¸å®Œå–„ï¼Œç§»é™¤è­¦å‘Šè¿ˆå‘äº†stableçš„é‡è¦ä¸€æ­¥</p>
<h2 id="New-V8-ArrayBuffer-API"><a href="#New-V8-ArrayBuffer-API" class="headerlink" title="New V8 ArrayBuffer API"></a>New V8 ArrayBuffer API</h2><p>v8ä¸å†æ”¯æŒå¤šä¸ªArrayBufferæŒ‡å‘ç›¸åŒçš„base address</p>
<h2 id="Toolchain-and-Compiler-Upgrades"><a href="#Toolchain-and-Compiler-Upgrades" class="headerlink" title="Toolchain and Compiler Upgrades"></a>Toolchain and Compiler Upgrades</h2><p>&#x2F;&#x2F;æ²¡çœ‹æ‡‚</p>
<ul>
<li><strong>(SEMVER-MAJOR)</strong> <strong>build</strong>: update macos deployment target to 10.13 for 14.x (AshCripps) <a target="_blank" rel="noopener" href="https://github.com/nodejs/node/pull/32454">#32454</a></li>
<li><strong>(SEMVER-MAJOR)</strong> <strong>doc</strong>: update cross compiler machine for Linux armv7 (Richard Lau) <a target="_blank" rel="noopener" href="https://github.com/nodejs/node/pull/32812">#32812</a></li>
<li><strong>(SEMVER-MAJOR)</strong> <strong>doc</strong>: update Centos&#x2F;RHEL releases use devtoolset-8 (Richard Lau) <a target="_blank" rel="noopener" href="https://github.com/nodejs/node/pull/32812">#32812</a></li>
<li><strong>(SEMVER-MAJOR)</strong> <strong>doc</strong>: remove SmartOS from official binaries (Richard Lau) <a target="_blank" rel="noopener" href="https://github.com/nodejs/node/pull/32812">#32812</a></li>
<li><strong>(SEMVER-MAJOR)</strong> <strong>win</strong>: block running on EOL Windows versions (JoÃ£o Reis) <a target="_blank" rel="noopener" href="https://github.com/nodejs/node/pull/31954">#31954</a></li>
</ul>
<p>It is expected that there will be an ABI mismatch on ARM between the Node.js binary and native addons. Native addons are only broken if they interact with <code>std::shared_ptr</code>. This is expected to be fixed in a later version of Node.js 14.</p>
<h2 id="Update-to-V8-8-1"><a href="#Update-to-V8-8-1" class="headerlink" title="Update to V8 8.1"></a>Update to V8 8.1</h2><h2 id="Others"><a href="#Others" class="headerlink" title="Others"></a>Others</h2><ul>
<li><strong>cli, report</strong>: move â€“report-on-fatalerror to stable (Colin Ihrig) </li>
<li><strong>deps</strong>: upgrade to libuv 1.37.0 (Colin Ihrig) </li>
<li><strong>fs</strong>: add fs&#x2F;promises alias module</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" title="Previous page" aria-label="Previous page" href="/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/11/">11</a><a class="extend next" rel="next" title="Next page" aria-label="Next page" href="/page/3/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2024</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">John Doe</span>
  </div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

    </div>
  </footer>

  
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  






  





</body>
</html>
